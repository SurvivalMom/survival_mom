<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ã“ã“ãƒ­ã‚° ä½“é¨“ç‰ˆï½œãƒãƒ¼ãƒ ã‚’ãã£ã¨æ”¯ãˆã‚‹å¯¾è©±è¨˜éŒ²</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Kaisei+Tokumin:wght@400;500;700&family=Zen+Kaku+Gothic+New:wght@400;500;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">

  <style>
    /* â•â•â•â•â•â•â•â•â•â• TOKENS â•â•â•â•â•â•â•â•â•â• */
    :root {
      --paper:     #faf7f2;
      --paper2:    #f3ede0;
      --paper3:    #e8dfcc;
      --warm-wh:   #fffef9;

      --ink:       #2c2318;
      --ink2:      #5a4a38;
      --ink3:      #9a8878;
      --ink4:      #c8b89a;
      --ink5:      #e0d4c0;

      --sage:      #5a7a5a;
      --sage2:     #789a78;
      --sage3:     #9ab89a;
      --sage-lt:   #e8f0e8;

      --blush:     #c87880;
      --blush2:    #d89098;
      --blush-lt:  #f8eced;

      --amber:     #b8781a;
      --amber2:    #d89030;
      --amber-lt:  #fdf3e0;

      --sky:       #5878a0;
      --sky-lt:    #e0eaf5;

      --lavender:  #8878a8;
      --lav-lt:    #ede8f5;

      --border:    rgba(44,35,24,0.13);
      --shadow-sm: 0 2px 8px rgba(44,35,24,0.07);
      --shadow:    0 4px 20px rgba(44,35,24,0.10);
      --shadow-lg: 0 10px 48px rgba(44,35,24,0.14);

      /* ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š */
      --theme-main: var(--sage);
      --theme-lt:   var(--sage-lt);
      --r-xl:26px; --r-lg:18px; --r-md:12px; --r-sm:7px;
    }

    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    html{scroll-behavior:smooth}

    body{
      font-family:'Zen Kaku Gothic New',sans-serif;
      background:var(--paper);color:var(--ink);
      min-height:100vh;overflow-x:hidden;position:relative;
    }

    /* å’Œç´™ãƒ†ã‚¯ã‚¹ãƒãƒ£èƒŒæ™¯ */
    body::before{
      content:'';position:fixed;inset:0;z-index:0;pointer-events:none;
      background:
        radial-gradient(ellipse 65% 55% at 5%  5%,  rgba(90,122,90,0.08),  transparent 55%),
        radial-gradient(ellipse 50% 45% at 95% 20%,  rgba(184,120,128,0.07), transparent 55%),
        radial-gradient(ellipse 45% 40% at 50% 95%,  rgba(184,120,26,0.06),  transparent 55%),
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.72' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='300' height='300' filter='url(%23n)' opacity='0.022'/%3E%3C/svg%3E");
    }
    body::after{content:'';position:fixed;inset:10px;z-index:0;pointer-events:none;border:1.5px solid rgba(44,35,24,0.08);border-radius:20px;}

    /* â•â•â•â•â•â•â•â•â•â• LAYOUT â•â•â•â•â•â•â•â•â•â• */
    .page{position:relative;z-index:1;max-width:620px;margin:0 auto;padding:0 18px 100px;}


    /* â”€â”€ åˆå›ã‚¬ã‚¤ãƒ‰ â”€â”€ */
    #welcomeGuide{
      position:fixed;inset:0;z-index:9999;
      background:rgba(44,35,24,0.55);
      display:flex;align-items:center;justify-content:center;
      padding:24px;
    }
    .guide-card{
      background:var(--warm-wh);
      border-radius:var(--r-xl);
      padding:36px 28px 30px;
      max-width:440px;width:100%;
      box-shadow:var(--shadow-lg);
      position:relative;overflow:hidden;
      animation:card-pop 0.45s cubic-bezier(.22,1,.36,1) both;
    }
    @keyframes card-pop{from{transform:scale(0.92) translateY(20px);opacity:0}to{transform:scale(1) translateY(0);opacity:1}}
    .guide-card::before{content:'';position:absolute;top:0;left:0;right:0;height:5px;background:linear-gradient(90deg,var(--sage),var(--sage2),#9ab89a,var(--sage2),var(--sage));border-radius:var(--r-xl) var(--r-xl) 0 0;}
    .guide-icon{font-size:2.8rem;text-align:center;display:block;margin-bottom:12px;}
    .guide-title{font-family:'Kaisei Tokumin',serif;font-size:1.25rem;font-weight:700;color:var(--ink);text-align:center;margin-bottom:8px;}
    .guide-body{font-size:0.82rem;color:var(--ink2);line-height:1.9;margin-bottom:18px;}
    .guide-checks{list-style:none;margin-bottom:20px;display:flex;flex-direction:column;gap:8px;}
    .guide-checks li{display:flex;align-items:flex-start;gap:8px;font-size:0.82rem;color:var(--ink2);line-height:1.6;}
    .guide-checks li .ico{color:var(--sage);flex-shrink:0;margin-top:1px;}
    .guide-skip-wrap{display:flex;align-items:center;gap:8px;margin-top:12px;justify-content:center;}
    .guide-skip-wrap label{font-size:0.72rem;color:var(--ink4);cursor:pointer;}

    /* â•â•â•â•â•â•â•â•â•â• SETUP SCREEN â•â•â•â•â•â•â•â•â•â• */
    #setupScreen{
      min-height:100vh;display:flex;align-items:center;justify-content:center;
      padding:32px 18px;
    }
    .setup-card{
      background:var(--warm-wh);
      border:1.5px solid var(--border);
      border-radius:var(--r-xl);
      padding:40px 32px 36px;
      width:100%;max-width:460px;
      box-shadow:var(--shadow-lg);
      position:relative;overflow:hidden;
    }
    .setup-card::before{content:'';position:absolute;top:0;left:0;right:0;height:5px;background:linear-gradient(90deg,var(--sage),var(--sage2),var(--blush2),var(--sage2),var(--sage));border-radius:var(--r-xl) var(--r-xl) 0 0;}

    .setup-icon{font-size:3rem;display:block;text-align:center;margin-bottom:14px;}
    .setup-title{font-family:'Kaisei Tokumin',serif;font-size:1.5rem;font-weight:700;color:var(--ink);text-align:center;margin-bottom:6px;}
    .setup-sub{font-size:0.82rem;color:var(--ink3);text-align:center;line-height:1.8;margin-bottom:28px;}

    .setup-section{margin-bottom:20px;}
    .setup-section-label{
      font-family:'DM Mono',monospace;
      font-size:0.6rem;font-weight:500;letter-spacing:0.22em;text-transform:uppercase;
      color:var(--ink4);margin-bottom:10px;
      display:flex;align-items:center;gap:8px;
    }
    .setup-section-label::after{content:'';flex:1;height:1px;background:var(--border);}

    /* ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼é¸æŠ */
    .theme-picks{display:flex;gap:8px;flex-wrap:wrap;}
    .theme-pick{
      width:36px;height:36px;border-radius:99px;border:3px solid transparent;
      cursor:pointer;transition:transform 0.15s,border-color 0.15s;
      position:relative;
    }
    .theme-pick:hover{transform:scale(1.12);}
    .theme-pick.active{border-color:var(--ink);}
    .theme-pick.active::after{content:'âœ“';position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:0.8rem;color:#fff;font-weight:700;}

    /* ãƒ•ã‚©ãƒ¼ãƒ å…±é€š */
    .form-row{margin-bottom:14px;}
    .form-label{display:block;font-size:0.78rem;font-weight:700;color:var(--ink2);margin-bottom:6px;}
    .form-label .hint{font-size:0.68rem;font-weight:400;color:var(--ink4);margin-left:6px;}
    .form-input,.form-select,.form-textarea{
      width:100%;padding:11px 14px;
      border:1.5px solid var(--border);border-radius:var(--r-md);
      font-family:'Zen Kaku Gothic New',sans-serif;
      font-size:0.9rem;font-weight:500;
      color:var(--ink);background:rgba(255,255,255,0.75);
      outline:none;transition:border-color 0.2s,box-shadow 0.2s;
    }
    .form-input:focus,.form-select:focus,.form-textarea:focus{border-color:var(--theme-main);box-shadow:0 0 0 3px rgba(90,122,90,0.12);}
    .form-textarea{min-height:80px;resize:vertical;line-height:1.65;}

    /* ãƒœã‚¿ãƒ³å…±é€š */
    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:7px;
      padding:12px 22px;border-radius:var(--r-md);border:1.5px solid transparent;
      font-family:'Zen Kaku Gothic New',sans-serif;font-size:0.88rem;font-weight:700;
      cursor:pointer;transition:all 0.16s cubic-bezier(.34,1.4,.64,1);
      text-decoration:none;
    }
    .btn:hover{transform:translateY(-2px);box-shadow:var(--shadow);}
    .btn:active{transform:scale(0.98);}
    .btn-primary{background:var(--sage);color:#fff;border-color:var(--sage);box-shadow:0 3px 14px rgba(90,122,90,0.28);}
    .btn-primary:hover{background:var(--sage2);}
    .btn-secondary{background:rgba(255,255,255,0.7);color:var(--ink2);border-color:var(--border);}
    .btn-danger{background:var(--blush-lt);color:var(--blush);border-color:rgba(200,120,128,0.3);}
    .btn-full{width:100%;}
    .btn-sm{padding:8px 14px;font-size:0.78rem;}
    .btn-amber{background:var(--amber);color:#fff;border-color:var(--amber);box-shadow:0 3px 14px rgba(184,120,26,0.28);}
    .btn-amber:hover{background:var(--amber2);}

    /* â•â•â•â•â•â•â•â•â•â• MAIN APP â•â•â•â•â•â•â•â•â•â• */
    #mainApp{display:none;}

    /* ã‚µã‚¤ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ */
    .site-header{
      padding:24px 0 18px;
      display:flex;justify-content:space-between;align-items:flex-start;
      border-bottom:1px solid var(--border);margin-bottom:24px;
    }
    .header-brand{}
    .brand-name{
      font-family:'Kaisei Tokumin',serif;
      font-size:1.3rem;font-weight:700;color:var(--ink);
      display:flex;align-items:center;gap:8px;
    }
    .brand-dot{
      width:10px;height:10px;border-radius:99px;
      background:var(--theme-main);
      display:inline-block;
    }
    .brand-sub{font-size:0.7rem;color:var(--ink4);margin-top:2px;}
    .user-chip{
      background:var(--theme-lt);
      border:1px solid rgba(90,122,90,0.2);
      border-radius:99px;padding:5px 12px;
      font-size:0.72rem;font-weight:700;color:var(--sage);
      display:flex;align-items:center;gap:5px;
    }

    /* ã‚¿ãƒ–ãƒŠãƒ“ */
    .tab-nav{
      display:flex;gap:6px;margin-bottom:22px;
      background:rgba(255,255,255,0.5);
      border:1.5px solid var(--border);
      border-radius:var(--r-lg);padding:5px;
    }
    .tab-btn{
      flex:1;padding:9px 8px;border-radius:var(--r-md);
      font-family:'Zen Kaku Gothic New',sans-serif;
      font-size:0.78rem;font-weight:700;
      border:none;background:none;color:var(--ink3);cursor:pointer;
      transition:all 0.18s;
    }
    .tab-btn.active{background:var(--warm-wh);color:var(--ink);box-shadow:var(--shadow-sm);border:1.5px solid var(--border);}

    /* ã‚¿ãƒ–ãƒ‘ãƒãƒ« */
    .tab-panel{display:none;}
    .tab-panel.active{display:block;}

    /* â”€â”€ ã‚«ãƒ¼ãƒ‰å…±é€š â”€â”€ */
    .card{
      background:var(--warm-wh);
      border:1.5px solid var(--border);
      border-radius:var(--r-xl);
      padding:24px 22px;
      box-shadow:var(--shadow-sm);
      margin-bottom:16px;
      position:relative;overflow:hidden;
    }
    .card-title{
      font-family:'Kaisei Tokumin',serif;
      font-size:1rem;font-weight:700;color:var(--ink);
      margin-bottom:16px;display:flex;align-items:center;gap:8px;
    }

    /* â”€â”€ è¨˜éŒ²ãƒ•ã‚©ãƒ¼ãƒ  â”€â”€ */
    .status-chips{display:flex;gap:7px;flex-wrap:wrap;margin-top:6px;}
    .status-chip{
      padding:6px 14px;border-radius:99px;
      font-size:0.75rem;font-weight:700;
      border:1.5px solid transparent;cursor:pointer;
      transition:all 0.15s;
    }
    .status-chip:hover{transform:scale(1.04);}
    .status-chip.active{box-shadow:0 2px 8px rgba(0,0,0,0.12);}
    .sc-genki  {background:var(--sage-lt);color:var(--sage);border-color:rgba(90,122,90,0.3);}
    .sc-tired  {background:var(--amber-lt);color:var(--amber);border-color:rgba(184,120,26,0.3);}
    .sc-flat   {background:var(--blush-lt);color:var(--blush);border-color:rgba(200,120,128,0.3);}
    .sc-unknown{background:var(--paper2);color:var(--ink3);border-color:var(--border);}
    .sc-genki.active  {background:var(--sage);color:#fff;}
    .sc-tired.active  {background:var(--amber);color:#fff;}
    .sc-flat.active   {background:var(--blush);color:#fff;}
    .sc-unknown.active{background:var(--ink3);color:#fff;}

    .form-actions{display:flex;gap:10px;margin-top:18px;flex-wrap:wrap;}

    /* â”€â”€ è¨˜éŒ²ãƒªã‚¹ãƒˆ â”€â”€ */
    .entry-list{display:flex;flex-direction:column;gap:12px;}
    .entry-card{
      background:var(--warm-wh);
      border:1.5px solid var(--border);
      border-radius:var(--r-xl);
      padding:18px 20px 16px;
      position:relative;overflow:hidden;
      box-shadow:var(--shadow-sm);
      animation:fade-up 0.4s ease both;
    }
    @keyframes fade-up{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .entry-stripe{position:absolute;left:0;top:10%;bottom:10%;width:4px;border-radius:0 99px 99px 0;}
    .es-genki  {background:var(--sage);}
    .es-tired  {background:var(--amber);}
    .es-flat   {background:var(--blush);}
    .es-unknown{background:var(--ink4);}

    .entry-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px;}
    .entry-name{font-family:'Kaisei Tokumin',serif;font-size:1rem;font-weight:700;color:var(--ink);}
    .entry-date{font-family:'DM Mono',monospace;font-size:0.65rem;color:var(--ink4);}
    .entry-status-badge{
      display:inline-flex;align-items:center;gap:4px;
      font-size:0.68rem;font-weight:700;
      padding:3px 10px;border-radius:99px;
      margin-bottom:8px;
    }
    .eb-genki  {background:var(--sage-lt);color:var(--sage);}
    .eb-tired  {background:var(--amber-lt);color:var(--amber);}
    .eb-flat   {background:var(--blush-lt);color:var(--blush);}
    .eb-unknown{background:var(--paper2);color:var(--ink3);}

    .entry-body{font-size:0.82rem;color:var(--ink2);line-height:1.7;}
    .entry-body strong{color:var(--ink3);font-size:0.7rem;display:block;margin-top:8px;margin-bottom:2px;font-family:'DM Mono',monospace;text-transform:uppercase;letter-spacing:0.1em;}
    .entry-del{position:absolute;top:12px;right:14px;background:none;border:none;font-size:0.75rem;color:var(--ink5);cursor:pointer;padding:4px;}
    .entry-del:hover{color:var(--blush);}

    /* â”€â”€ æ°—ã¥ããƒ‘ãƒãƒ« â”€â”€ */
    .insight-card{
      background:linear-gradient(145deg,var(--sage-lt),rgba(232,240,232,0.6));
      border:1.5px solid rgba(90,122,90,0.2);
      border-radius:var(--r-xl);
      padding:22px 22px 18px;
      margin-bottom:16px;
    }
    .insight-title{font-family:'Kaisei Tokumin',serif;font-size:0.95rem;font-weight:700;color:var(--sage);margin-bottom:12px;display:flex;align-items:center;gap:7px;}
    .insight-row{display:flex;align-items:center;gap:10px;margin-bottom:8px;font-size:0.82rem;}
    .insight-dot{width:9px;height:9px;border-radius:99px;flex-shrink:0;}
    .insight-empty{font-size:0.82rem;color:var(--ink4);text-align:center;padding:16px 0;}

    /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ†å¸ƒãƒãƒ¼ */
    .dist-bar{display:flex;height:8px;border-radius:99px;overflow:hidden;gap:2px;margin-bottom:12px;}
    .dist-seg{border-radius:99px;transition:flex 0.4s ease;}

    /* â”€â”€ å®‰å¿ƒã‚«ãƒ¼ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ â”€â”€ */
    .trust-card{
      background:var(--warm-wh);
      border:1.5px dashed var(--border);
      border-radius:var(--r-lg);
      padding:20px 18px;
      font-size:0.82rem;color:var(--ink2);line-height:1.85;
    }
    .trust-card-title{font-family:'Kaisei Tokumin',serif;font-size:0.95rem;font-weight:700;color:var(--sage);margin-bottom:10px;display:flex;align-items:center;gap:6px;}
    .trust-item{display:flex;align-items:flex-start;gap:8px;margin-bottom:6px;}
    .trust-check{color:var(--sage);flex-shrink:0;margin-top:1px;}

    /* â”€â”€ è¨­å®šãƒ‘ãƒãƒ« â”€â”€ */
    .settings-row{display:flex;justify-content:space-between;align-items:center;padding:14px 0;border-bottom:1px solid var(--border);}
    .settings-label{font-size:0.85rem;font-weight:700;color:var(--ink2);}
    .settings-value{font-size:0.82rem;color:var(--ink4);}

    /* â”€â”€ ç©ºãƒªã‚¹ãƒˆ â”€â”€ */
    .empty-state{text-align:center;padding:40px 20px;color:var(--ink4);}
    .empty-icon{font-size:2.5rem;margin-bottom:10px;}
    .empty-text{font-size:0.84rem;line-height:1.8;}

    /* â”€â”€ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ â”€â”€ */
    .filter-bar{display:flex;gap:7px;flex-wrap:wrap;margin-bottom:16px;}
    .filter-chip{
      padding:5px 12px;border-radius:99px;border:1.5px solid var(--border);
      font-size:0.72rem;font-weight:700;background:rgba(255,255,255,0.6);
      color:var(--ink3);cursor:pointer;transition:all 0.14s;
    }
    .filter-chip:hover{border-color:var(--sage);color:var(--sage);}
    .filter-chip.active{background:var(--sage);color:#fff;border-color:var(--sage);}

    /* â”€â”€ æ¤œç´¢ â”€â”€ */
    .search-wrap{position:relative;margin-bottom:14px;}
    .search-icon{position:absolute;left:12px;top:50%;transform:translateY(-50%);font-size:0.9rem;color:var(--ink4);}
    .search-input{width:100%;padding:10px 14px 10px 34px;border:1.5px solid var(--border);border-radius:var(--r-md);font-family:'Zen Kaku Gothic New',sans-serif;font-size:0.85rem;color:var(--ink);background:rgba(255,255,255,0.7);outline:none;transition:border-color 0.2s;}
    .search-input:focus{border-color:var(--sage);}

    /* â”€â”€ ãƒˆãƒ¼ã‚¹ãƒˆ â”€â”€ */
    #toast{
      position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(80px);
      background:var(--ink);color:#fff;padding:11px 22px;border-radius:99px;
      font-size:0.82rem;font-weight:700;
      transition:transform 0.3s cubic-bezier(.34,1.4,.64,1);
      z-index:9999;white-space:nowrap;
    }
    #toast.show{transform:translateX(-50%) translateY(0);}

    /* â”€â”€ å°åˆ· â”€â”€ */
    @media print{
      body{background:white!important;}
      #mainApp,.site-header,.tab-nav{display:none!important;}
      #printArea{display:block!important;}
    }
    #printArea{display:none;}

    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
    @media(max-width:480px){
      .card{padding:18px 16px;}
      .setup-card{padding:30px 20px 26px;}
      .form-actions{flex-direction:column;}
      .form-actions .btn{width:100%;}
    }

    /* â•â•â•â•â•â•â•â•â•â• TRIAL LOCK â•â•â•â•â•â•â•â•â•â• */
    .trial-badge{
      display:inline-flex;align-items:center;gap:5px;
      background:var(--amber-lt);border:1.5px solid rgba(184,120,26,0.3);
      border-radius:99px;padding:4px 12px;
      font-family:'DM Mono',monospace;
      font-size:0.58rem;font-weight:500;letter-spacing:0.16em;
      text-transform:uppercase;color:var(--amber);
      margin-left:8px;
    }
    .lock-overlay{
      position:relative;
    }
    .lock-overlay::after{
      content:'';
      position:absolute;inset:0;
      background:rgba(250,247,242,0.82);
      border-radius:inherit;
      backdrop-filter:blur(2px);
      z-index:10;pointer-events:none;
    }
    .lock-gate{
      background:linear-gradient(135deg,var(--warm-wh),var(--paper2));
      border:1.5px solid var(--border);
      border-radius:var(--r-xl);
      padding:28px 22px;
      text-align:center;
      box-shadow:var(--shadow-sm);
      margin-bottom:16px;
    }
    .lock-gate-icon{font-size:2rem;margin-bottom:10px;display:block;}
    .lock-gate-title{
      font-family:'Kaisei Tokumin',serif;
      font-size:1rem;font-weight:700;color:var(--ink);
      margin-bottom:14px;
    }
    .lock-features{
      list-style:none;display:flex;flex-direction:column;gap:7px;
      margin-bottom:20px;text-align:left;
      background:rgba(255,255,255,0.6);
      border:1px solid var(--border);border-radius:var(--r-md);
      padding:14px 16px;
    }
    .lock-features li{
      display:flex;align-items:center;gap:8px;
      font-size:0.82rem;color:var(--ink2);font-weight:500;
    }
    .lock-features li .lf-ico{color:var(--sage);font-size:0.9rem;}
    .lock-cta{
      display:block;width:100%;padding:13px;
      background:linear-gradient(135deg,var(--sage),var(--sage2));
      color:#fff;border:none;border-radius:var(--r-md);
      font-family:'Zen Kaku Gothic New',sans-serif;
      font-size:0.88rem;font-weight:700;
      cursor:pointer;letter-spacing:0.03em;
      box-shadow:0 4px 18px rgba(90,122,90,0.3);
      text-decoration:none;display:flex;align-items:center;justify-content:center;gap:7px;
      transition:all 0.16s cubic-bezier(.34,1.4,.64,1);
    }
    .lock-cta:hover{transform:translateY(-2px);box-shadow:0 7px 24px rgba(90,122,90,0.38);}
    .lock-note{font-size:0.68rem;color:var(--ink4);margin-top:10px;line-height:1.7;}

    /* è¨˜éŒ²ä»¶æ•°ãƒãƒ¼ */
    .record-limit-bar{
      background:var(--amber-lt);
      border:1.5px solid rgba(184,120,26,0.25);
      border-radius:var(--r-md);
      padding:10px 14px;
      display:flex;align-items:center;justify-content:space-between;
      margin-bottom:14px;font-size:0.78rem;
    }
    .record-limit-label{font-weight:700;color:var(--amber);}
    .record-limit-dots{display:flex;gap:5px;}
    .rld{width:14px;height:14px;border-radius:99px;border:1.5px solid rgba(184,120,26,0.3);}
    .rld.filled{background:var(--sage);}
    .rld.locked{background:var(--ink5);}
  </style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â• åˆå›ã‚¬ã‚¤ãƒ‰ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ â•â•â•â•â•â•â•â•â•â• -->
<div id="welcomeGuide" style="display:none">
  <div class="guide-card">
    <span class="guide-icon">ğŸŒ¿</span>
    <h2 class="guide-title">ã“ã®ãƒ„ãƒ¼ãƒ«ã«ã¤ã„ã¦</h2>
    <p class="guide-body">
      <strong id="guideUserName">ã‚ãªãŸ</strong>ãŒä½¿ã†ã“ã®ã€Œã“ã“ãƒ­ã‚°ã€ã¯ã€<br>
      <strong id="guideTeam">ãƒãƒ¼ãƒ ã®ã¿ãªã•ã‚“</strong>ã‚’ãã£ã¨æ°—ã«ã‹ã‘ã‚‹ãŸã‚ã®<br>
      å¯¾è©±è¨˜éŒ²ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
    </p>
    <ul class="guide-checks">
      <li><span class="ico">âœ”</span><span>è©±ã—ã¦ãã‚ŒãŸå†…å®¹ã¯ã€ã‚µãƒãƒ¼ãƒˆç›®çš„ã®ã¿ã§ä½¿ã„ã¾ã™</span></li>
      <li><span class="ico">âœ”</span><span>è©•ä¾¡ãƒ»æŸ»å®šã«ã¯ä¸€åˆ‡ä½¿ã‚ã‚Œã¾ã›ã‚“</span></li>
      <li><span class="ico">âœ”</span><span>è¨˜éŒ²ã¯ã“ã®ç«¯æœ«ã«ã®ã¿ä¿å­˜ã•ã‚Œã¾ã™</span></li>
      <li><span class="ico">âœ”</span><span>è©±ã—ãŸããªã„ã“ã¨ã¯ã€ç„¡ç†ã«è©±ã•ãªãã¦å¤§ä¸ˆå¤«ã§ã™</span></li>
    </ul>
    <button class="btn btn-primary btn-full" onclick="closeGuide()">ã‚ã‹ã‚Šã¾ã—ãŸã€ã¯ã˜ã‚ã¾ã™ ğŸŒ±</button>
    <div class="guide-skip-wrap">
      <input type="checkbox" id="guideSkipCheck" onchange="skipGuideForever(this)">
      <label for="guideSkipCheck">ä»Šå¾Œã“ã®èª¬æ˜ã¯è¡¨ç¤ºã—ãªã„</label>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ç”»é¢ â•â•â•â•â•â•â•â•â•â• -->
<div id="setupScreen">
  <div class="setup-card">
    <span class="setup-icon">ğŸŒ¿</span>
    <h1 class="setup-title">ã“ã“ãƒ­ã‚°ã¸ã‚ˆã†ã“ã</h1>
    <p class="setup-sub">
      ãƒãƒ¼ãƒ ã®ãƒ¡ãƒ³ãƒãƒ¼ã‚’ãã£ã¨æ°—ã«ã‹ã‘ã‚‹<br>
      ã‚·ãƒ³ãƒ—ãƒ«ãªå¯¾è©±è¨˜éŒ²ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚<br>
      ã¾ãšã€ã‚ãªãŸã®æƒ…å ±ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚
    </p>

    <div class="setup-section">
      <div class="setup-section-label">ã‚ãªãŸã«ã¤ã„ã¦</div>
      <div class="form-row">
        <label class="form-label">ã‚ãªãŸã®ãŠåå‰<span class="hint">ï¼ˆä¾‹ï¼šä½è—¤ï¼‰</span></label>
        <input class="form-input" id="setupMyName" placeholder="ä¾‹ï¼šç”°ä¸­ã•ã¤ã" />
      </div>
      <div class="form-row">
        <label class="form-label">ã‚ãªãŸã®å½¹å‰²ãƒ»ç«‹å ´<span class="hint">ï¼ˆè‡ªç”±ã«å…¥åŠ›ã§ãã¾ã™ï¼‰</span></label>
        <input class="form-input" id="setupMyRole" placeholder="ä¾‹ï¼šãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ€ãƒ¼ / å…ˆè¼©ã‚¹ã‚¿ãƒƒãƒ• / å¾©å¸°çµ„ ç­‰" />
      </div>
    </div>

    <div class="setup-section">
      <div class="setup-section-label">ãƒãƒ¼ãƒ ã«ã¤ã„ã¦</div>
      <div class="form-row">
        <label class="form-label">ãƒãƒ¼ãƒ åãƒ»éƒ¨ç½²å<span class="hint">ï¼ˆä»»æ„ï¼‰</span></label>
        <input class="form-input" id="setupTeamName" placeholder="ä¾‹ï¼šåˆå‰ãƒãƒ¼ãƒ  / å–¶æ¥­2èª² / å­è‚²ã¦ãƒ•ãƒ¬ãƒƒã‚¯ã‚¹ç­ ç­‰" />
      </div>
      <div class="form-row">
        <label class="form-label">æ°—ã«ã‹ã‘ã‚‹ç›¸æ‰‹ã®å‘¼ã³æ–¹<span class="hint">ï¼ˆè¤‡æ•°å¯ï¼‰</span></label>
        <input class="form-input" id="setupMemberLabel" placeholder="ä¾‹ï¼šã‚¹ã‚¿ãƒƒãƒ• / ãƒ¡ãƒ³ãƒãƒ¼ / ä»²é–“ / åŒåƒš" />
      </div>
    </div>

    <div class="setup-section">
      <div class="setup-section-label">ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼</div>
      <div class="theme-picks" id="themePicks">
        <div class="theme-pick active" data-color="#5a7a5a" data-lt="#e8f0e8" style="background:#5a7a5a" title="ã‚»ãƒ¼ã‚¸ã‚°ãƒªãƒ¼ãƒ³"></div>
        <div class="theme-pick" data-color="#8878a8" data-lt="#ede8f5" style="background:#8878a8" title="ãƒ©ãƒ™ãƒ³ãƒ€ãƒ¼"></div>
        <div class="theme-pick" data-color="#5878a0" data-lt="#e0eaf5" style="background:#5878a0" title="ã‚¹ãƒãƒ¼ãƒ«ãƒ–ãƒ«ãƒ¼"></div>
        <div class="theme-pick" data-color="#c87880" data-lt="#f8eced" style="background:#c87880" title="ãƒ­ãƒ¼ã‚º"></div>
        <div class="theme-pick" data-color="#b8781a" data-lt="#fdf3e0" style="background:#b8781a" title="ã‚¢ãƒ³ãƒãƒ¼"></div>
        <div class="theme-pick" data-color="#7a9878" data-lt="#e8f2e8" style="background:#7a9878" title="ãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã‚°ãƒªãƒ¼ãƒ³"></div>
      </div>
    </div>

    <button class="btn btn-primary btn-full" onclick="startApp()" style="margin-top:24px">
      ğŸŒ± ã¯ã˜ã‚ã‚‹
    </button>
    <p style="font-size:0.68rem;color:var(--ink4);text-align:center;margin-top:10px;line-height:1.7;">
      â€» å…¥åŠ›ã—ãŸæƒ…å ±ã¯ã“ã®ç«¯æœ«ã®ã¿ã«ä¿å­˜ã•ã‚Œã¾ã™<br>å¤–éƒ¨ã«é€ä¿¡ã•ã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“
    </p>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒª â•â•â•â•â•â•â•â•â•â• -->
<div id="mainApp">
<div class="page">

  <!-- ã‚µã‚¤ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header class="site-header">
    <div class="header-brand">
      <div class="brand-name">
        <span class="brand-dot"></span>
        ã“ã“ãƒ­ã‚°
        <span class="trial-badge">ğŸ”“ ä½“é¨“ç‰ˆ</span>
      </div>
      <div class="brand-sub" id="headerTeam">ãƒãƒ¼ãƒ </div>
    </div>
    <div style="display:flex;align-items:center;gap:8px;">
      <div class="user-chip" id="headerUser">ğŸŒ¿ ã‚ãªãŸ</div>
      <button class="btn btn-secondary btn-sm" onclick="showSettings()">âš™ï¸</button>
    </div>
  </header>

  <!-- ã‚¿ãƒ–ãƒŠãƒ“ -->
  <nav class="tab-nav">
    <button class="tab-btn active" onclick="switchTab('record')">âœï¸ è¨˜éŒ²ã™ã‚‹</button>
    <button class="tab-btn" onclick="switchTab('list')">ğŸ“‹ ä¸€è¦§</button>
    <button class="tab-btn" onclick="switchTab('insight')">ğŸ’¡ æ°—ã¥ã</button>
    <button class="tab-btn" onclick="switchTab('guide')">ğŸ¤ å…±æœ‰ã‚«ãƒ¼ãƒ‰</button>
  </nav>

  <!-- â”€â”€ TAB: è¨˜éŒ² â”€â”€ -->
  <div id="tab-record" class="tab-panel active">
    <!-- ä½“é¨“ç‰ˆï¼šä»¶æ•°ãƒãƒ¼ -->
    <div class="record-limit-bar" id="limitBar">
      <div>
        <span class="record-limit-label">ä½“é¨“ç‰ˆ è¨˜éŒ²</span>
        <span id="limitCount" style="color:var(--ink3);font-size:0.72rem;margin-left:6px">0 / 3ä»¶</span>
      </div>
      <div class="record-limit-dots" id="limitDots">
        <div class="rld" id="dot1"></div>
        <div class="rld" id="dot2"></div>
        <div class="rld" id="dot3"></div>
      </div>
    </div>
    <div class="card">
      <div class="card-title">ğŸŒ¿ ä»Šæ—¥ã®å¯¾è©±ã‚’è¨˜éŒ²ã™ã‚‹</div>

      <div class="form-row">
        <label class="form-label">æ—¥ä»˜</label>
        <input class="form-input" type="date" id="fDate" />
      </div>

      <div class="form-row">
        <label class="form-label" id="memberLabel">ç›¸æ‰‹ã®åå‰</label>
        <input class="form-input" id="fName" placeholder="ä¾‹ï¼šå±±ç”°ã•ã‚“" />
      </div>

      <div class="form-row">
        <label class="form-label">ä»Šæ—¥ã®æ§˜å­</label>
        <div class="status-chips">
          <div class="status-chip sc-genki active"  data-val="å…ƒæ°—"     onclick="selectStatus(this)">ğŸ˜Š å…ƒæ°—</div>
          <div class="status-chip sc-tired"          data-val="ç–²ã‚Œã¦ã„ã‚‹" onclick="selectStatus(this)">ğŸ˜” ç–²ã‚Œã¦ã„ã‚‹</div>
          <div class="status-chip sc-flat"            data-val="è¡¨æƒ…ãŒä¹ã—ã„" onclick="selectStatus(this)">ğŸ˜¶ è¡¨æƒ…ãŒä¹ã—ã„</div>
          <div class="status-chip sc-unknown"        data-val="ã‚ã‹ã‚‰ãªã„" onclick="selectStatus(this)">ğŸ¤” ã‚ã‹ã‚‰ãªã„</div>
        </div>
      </div>

      <div class="form-row">
        <label class="form-label">è©±ã—ãŸå†…å®¹<span class="hint">ï¼ˆä»»æ„ï¼‰</span></label>
        <textarea class="form-textarea" id="fTopic" placeholder="ä»•äº‹ã®ã“ã¨ã€å®¶ã®ã“ã¨ã€ä½“èª¿ã®ã“ã¨ â€” æ›¸ã‘ã‚‹ç¯„å›²ã§"></textarea>
      </div>

      <div class="form-row">
        <label class="form-label">ã‚ãªãŸãŒæ„Ÿã˜ãŸã“ã¨<span class="hint">ï¼ˆä»»æ„ï¼‰</span></label>
        <textarea class="form-textarea" id="fReflection" placeholder="å°‘ã—å…ƒæ°—ãŒãªã„æ°—ãŒã—ãŸã€å¬‰ã—ãã†ã ã£ãŸâ€¦ ãªã©"></textarea>
      </div>

      <div class="form-row">
        <label class="form-label">æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³<span class="hint">ï¼ˆä»»æ„ï¼‰</span></label>
        <input class="form-input" id="fAction" placeholder="ä¾‹ï¼šæ¥é€±ã¾ãŸå£°ã‚’ã‹ã‘ã‚‹ / ä¸Šã«ç›¸è«‡ã™ã‚‹" />
      </div>

      <div class="form-actions">
        <button class="btn btn-primary" onclick="saveRecord()" style="flex:1">âœï¸ è¨˜éŒ²ã™ã‚‹</button>
        <button class="btn btn-secondary" onclick="clearForm()">ã‚¯ãƒªã‚¢</button>
      </div>
    </div>

    <!-- æœ€è¿‘ã®è¨˜éŒ²ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆæœ€æ–°3ä»¶ï¼‰ -->
    <div class="card-title" style="margin-left:4px;margin-top:8px">ğŸ“‹ æœ€è¿‘ã®è¨˜éŒ²</div>
    <div id="recentList" class="entry-list"></div>
  </div>

  <!-- â”€â”€ TAB: ä¸€è¦§ â”€â”€ -->
  <div id="tab-list" class="tab-panel">
    <div class="search-wrap">
      <span class="search-icon">ğŸ”</span>
      <input class="search-input" id="searchInput" placeholder="åå‰ã‚„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢" oninput="renderList()">
    </div>
    <div class="filter-bar">
      <div class="filter-chip active" data-filter="all" onclick="setFilter(this)">ã™ã¹ã¦</div>
      <div class="filter-chip" data-filter="å…ƒæ°—" onclick="setFilter(this)">ğŸ˜Š å…ƒæ°—</div>
      <div class="filter-chip" data-filter="ç–²ã‚Œã¦ã„ã‚‹" onclick="setFilter(this)">ğŸ˜” ç–²ã‚Œã¦ã„ã‚‹</div>
      <div class="filter-chip" data-filter="è¡¨æƒ…ãŒä¹ã—ã„" onclick="setFilter(this)">ğŸ˜¶ è¡¨æƒ…ãŒä¹ã—ã„</div>
      <div class="filter-chip" data-filter="ã‚ã‹ã‚‰ãªã„" onclick="setFilter(this)">ğŸ¤” ã‚ã‹ã‚‰ãªã„</div>
    </div>
    <div id="fullList" class="entry-list"></div>
    <div style="text-align:right;margin-top:16px;">
      <button class="btn btn-secondary btn-sm" onclick="openTrialLock()" style="cursor:not-allowed;opacity:0.6">ğŸ”’ CSVã§ä¿å­˜ï¼ˆCustomç‰ˆï¼‰</button>
    </div>
  </div>

  <!-- â”€â”€ TAB: æ°—ã¥ã â”€â”€ -->
  <div id="tab-insight" class="tab-panel">
    <div class="lock-gate">
      <span class="lock-gate-icon">ğŸ”’</span>
      <div class="lock-gate-title">ã“ã®å…ˆã¯ Customç‰ˆã§è§£æ”¾ã•ã‚Œã¾ã™</div>
      <ul class="lock-features">
        <li><span class="lf-ico">âœ”</span>è¨˜éŒ²ç„¡åˆ¶é™</li>
        <li><span class="lf-ico">âœ”</span>ãƒãƒ¼ãƒ å…¨ä½“ã®çŠ¶æ…‹åˆ†æ</li>
        <li><span class="lf-ico">âœ”</span>ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—å€™è£œã®è‡ªå‹•æŠ½å‡º</li>
        <li><span class="lf-ico">âœ”</span>CSVå‡ºåŠ›</li>
        <li><span class="lf-ico">âœ”</span>å°åˆ·ãƒ»å…±æœ‰</li>
      </ul>
      <div style="font-size:0.78rem;color:var(--ink3);font-weight:700;margin-bottom:14px;">ç¾å ´ã§æœ¬æ°—ã§ä½¿ã†æ–¹ã¸ â†’ Customç‰ˆã¸</div>
      <a class="lock-cta" href="#" onclick="return false">ğŸŒ± Customç‰ˆã®è©³ç´°ã‚’è¦‹ã‚‹</a>
      <p class="lock-note">â€» ã”è³¼å…¥å…ˆã®URLã«å·®ã—æ›¿ãˆã¦ã”åˆ©ç”¨ãã ã•ã„</p>
    </div>
  </div>

  <!-- â”€â”€ TAB: å…±æœ‰ã‚«ãƒ¼ãƒ‰ â”€â”€ -->
  <div id="tab-guide" class="tab-panel">
    <div class="card">
      <div class="card-title">ğŸ¤ ç›¸æ‰‹ã«æ¸¡ã›ã‚‹ã€Œå®‰å¿ƒã‚«ãƒ¼ãƒ‰ã€</div>
      <p style="font-size:0.8rem;color:var(--ink3);margin-bottom:16px;line-height:1.75;">
        ã€Œãªãœå£°ã‚’ã‹ã‘ã¦ãã‚‹ã®ï¼Ÿã€ã¨æ€ã‚ã‚Œãªã„ã‚ˆã†ã€<br>
        ã“ã®ã‚«ãƒ¼ãƒ‰ã‚’æœ€åˆã«æ¸¡ã™ã¨é–¢ä¿‚ãŒã‚¹ãƒ ãƒ¼ã‚ºã«ãªã‚Šã¾ã™ã€‚
      </p>
      <div class="trust-card" id="trustCardPreview">
        <!-- JSç”Ÿæˆ -->
      </div>
      <div style="margin-top:16px;display:flex;gap:10px;flex-wrap:wrap;">
        <button class="btn btn-secondary" onclick="openTrialLock()" style="cursor:not-allowed;opacity:0.6">ğŸ”’ å°åˆ·ã™ã‚‹ï¼ˆCustomç‰ˆï¼‰</button>
        <button class="btn btn-secondary" onclick="copyTrustCard()">ğŸ“‹ ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼</button>
      </div>
    </div>

    <div class="card">
      <div class="card-title">âœï¸ ã‚«ãƒ¼ãƒ‰ã®æ–‡ç« ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º</div>
      <div class="form-row">
        <label class="form-label">ã‚«ãƒ¼ãƒ‰ã®ã‚¿ã‚¤ãƒˆãƒ«</label>
        <input class="form-input" id="cardTitle" value="ã‚ãªãŸã®ã“ã¨ã‚’æ°—ã«ã‹ã‘ã¦ã„ã¾ã™" />
      </div>
      <div class="form-row">
        <label class="form-label">ä¸€è¨€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</label>
        <textarea class="form-textarea" id="cardMessage" style="min-height:70px">ã¡ã‚‡ã£ã¨ã—ãŸå£°ã‹ã‘ã‚’ã—ã¦ã„ã‚‹ã®ã¯ã€è©•ä¾¡ã®ãŸã‚ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚ãªãŸãŒæ¯æ—¥ã‚’å°‘ã—ã§ã‚‚ãƒ©ã‚¯ã«éã”ã›ã‚‹ã‚ˆã†ã€ãã£ã¨æ°—ã«ã‹ã‘ã¦ã„ãŸã„ã¨æ€ã£ã¦ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚</textarea>
      </div>
      <button class="btn btn-primary btn-sm" onclick="updateTrustCard()">ã‚«ãƒ¼ãƒ‰ã‚’æ›´æ–°ã™ã‚‹</button>
    </div>
  </div>

</div><!-- /page -->
</div><!-- /mainApp -->

<!-- è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="settingsModal" style="display:none;position:fixed;inset:0;z-index:9000;background:rgba(44,35,24,0.5);display:none;align-items:center;justify-content:center;padding:20px;">
  <div class="setup-card" style="max-width:420px;max-height:90vh;overflow-y:auto;">
    <h2 class="setup-title" style="font-size:1.1rem;text-align:left;margin-bottom:20px;">âš™ï¸ è¨­å®š</h2>
    <div class="settings-row">
      <span class="settings-label">åå‰</span>
      <span class="settings-value" id="setMyName"></span>
    </div>
    <div class="settings-row">
      <span class="settings-label">å½¹å‰²</span>
      <span class="settings-value" id="setMyRole"></span>
    </div>
    <div class="settings-row">
      <span class="settings-label">ãƒãƒ¼ãƒ </span>
      <span class="settings-value" id="setTeamName"></span>
    </div>
    <div class="settings-row" style="border:none">
      <span class="settings-label">è¨˜éŒ²ä»¶æ•°</span>
      <span class="settings-value" id="setRecordCount"></span>
    </div>
    <div style="margin-top:20px;display:flex;flex-direction:column;gap:10px;">
      <button class="btn btn-secondary btn-full" onclick="hideSettings()">é–‰ã˜ã‚‹</button>
      <button class="btn btn-danger btn-full btn-sm" onclick="resetApp()">ğŸ—‘ï¸ ãƒ‡ãƒ¼ã‚¿ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¦ãƒªã‚»ãƒƒãƒˆ</button>
    </div>
  </div>
</div>

<!-- ãƒˆãƒ¼ã‚¹ãƒˆ -->
<div id="toast">ä¿å­˜ã—ã¾ã—ãŸ</div>

<!-- å°åˆ·ã‚¨ãƒªã‚¢ -->
<div id="printArea"></div>

<script>
/* â•â•â•â•â•â•â•â•â•â• TRIAL FLAGS â•â•â•â•â•â•â•â•â•â• */
const IS_TRIAL = true;
const MAX_RECORDS = 3;

/* â•â•â•â•â•â•â•â•â•â• STATE â•â•â•â•â•â•â•â•â•â• */
var STATE = {
  myName: '', myRole: '', teamName: '', memberLabel: 'ãƒ¡ãƒ³ãƒãƒ¼',
  themeColor: '#5a7a5a', themeLt: '#e8f0e8',
  cardTitle: 'ã‚ãªãŸã®ã“ã¨ã‚’æ°—ã«ã‹ã‘ã¦ã„ã¾ã™',
  cardMessage: 'ã¡ã‚‡ã£ã¨ã—ãŸå£°ã‹ã‘ã‚’ã—ã¦ã„ã‚‹ã®ã¯ã€è©•ä¾¡ã®ãŸã‚ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚ãªãŸãŒæ¯æ—¥ã‚’å°‘ã—ã§ã‚‚ãƒ©ã‚¯ã«éã”ã›ã‚‹ã‚ˆã†ã€ãã£ã¨æ°—ã«ã‹ã‘ã¦ã„ãŸã„ã¨æ€ã£ã¦ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚',
  records: [],
  totalSaved: 0
};

var STORAGE_KEY = 'kokoLog_v2';

/* â”€â”€ ãƒ­ãƒ¼ãƒ‰ â”€â”€ */
(function(){
  try {
    var saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      STATE = Object.assign(STATE, JSON.parse(saved));
      // æ—§ãƒ‡ãƒ¼ã‚¿äº’æ›ï¼štotalSavedãŒãªã‘ã‚Œã°records.lengthã§åˆæœŸåŒ–
      if (STATE.totalSaved === undefined) {
        STATE.totalSaved = STATE.records.length;
      }
      if (STATE.myName) {
        startApp(true);
        // åˆå›ã‚¬ã‚¤ãƒ‰è¡¨ç¤º
        if (localStorage.getItem('kokoLog_guideSkip') !== '1') {
          setTimeout(function(){
            var g = document.getElementById('welcomeGuide');
            if (g) { updateGuideText(); g.style.display = 'flex'; }
          }, 600);
        }
        return;
      }
    }
  } catch(e) {}
  // ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
  document.getElementById('fDate').value = today();
})();

function today() {
  return new Date().toISOString().slice(0,10);
}

/* â”€â”€ ä¿å­˜ â”€â”€ */
function saveState() {
  try { localStorage.setItem(STORAGE_KEY, JSON.stringify(STATE)); } catch(e) {}
}

/* â•â•â•â•â•â•â•â•â•â• SETUP â•â•â•â•â•â•â•â•â•â• */
var selectedTheme = { color: '#5a7a5a', lt: '#e8f0e8' };

// ãƒ†ãƒ¼ãƒãƒ”ãƒƒã‚«ãƒ¼
document.querySelectorAll('.theme-pick').forEach(function(el){
  el.addEventListener('click', function(){
    document.querySelectorAll('.theme-pick').forEach(function(e){ e.classList.remove('active'); });
    el.classList.add('active');
    selectedTheme = { color: el.dataset.color, lt: el.dataset.lt };
    document.documentElement.style.setProperty('--theme-main', selectedTheme.color);
    document.documentElement.style.setProperty('--theme-lt', selectedTheme.lt);
  });
});

function startApp(fromStorage) {
  if (!fromStorage) {
    var name = document.getElementById('setupMyName').value.trim();
    if (!name) { document.getElementById('setupMyName').focus(); return; }
    STATE.myName      = name;
    STATE.myRole      = document.getElementById('setupMyRole').value.trim() || 'è¨˜éŒ²ã™ã‚‹äºº';
    STATE.teamName    = document.getElementById('setupTeamName').value.trim() || '';
    STATE.memberLabel = document.getElementById('setupMemberLabel').value.trim() || 'ãƒ¡ãƒ³ãƒãƒ¼';
    STATE.themeColor  = selectedTheme.color;
    STATE.themeLt     = selectedTheme.lt;
    saveState();
  }

  // ãƒ†ãƒ¼ãƒé©ç”¨
  document.documentElement.style.setProperty('--theme-main', STATE.themeColor);
  document.documentElement.style.setProperty('--theme-lt', STATE.themeLt);

  document.getElementById('setupScreen').style.display = 'none';
  document.getElementById('mainApp').style.display = 'block';

  // ãƒ˜ãƒƒãƒ€ãƒ¼æ›´æ–°
  document.getElementById('headerUser').textContent = 'ğŸŒ¿ ' + STATE.myName;
  document.getElementById('headerTeam').textContent = STATE.teamName || 'ãƒãƒ¼ãƒ ';
  document.getElementById('memberLabel').textContent = STATE.memberLabel + 'ã®åå‰';

  // æ—¥ä»˜åˆæœŸåŒ–
  document.getElementById('fDate').value = today();

  // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
  renderRecent();
  renderList();
  renderTrustCard();
  updateLimitBar();
}

/* â•â•â•â•â•â•â•â•â•â• TAB â•â•â•â•â•â•â•â•â•â• */
var currentTab = 'record';

function switchTab(name) {
  currentTab = name;
  document.querySelectorAll('.tab-panel').forEach(function(p){ p.classList.remove('active'); });
  document.querySelectorAll('.tab-btn').forEach(function(b){ b.classList.remove('active'); });
  document.getElementById('tab-' + name).classList.add('active');
  var btns = document.querySelectorAll('.tab-btn');
  var idx = ['record','list','insight','guide'].indexOf(name);
  if (btns[idx]) btns[idx].classList.add('active');

  if (name === 'list')    renderList();
  // if (name === 'insight') renderInsight(); // trial: locked
  if (name === 'guide')   renderTrustCard();
}

/* â•â•â•â•â•â•â•â•â•â• è¨˜éŒ²ãƒ•ã‚©ãƒ¼ãƒ  â•â•â•â•â•â•â•â•â•â• */
var selectedStatus = 'å…ƒæ°—';

function selectStatus(el) {
  document.querySelectorAll('.status-chip').forEach(function(c){ c.classList.remove('active'); });
  el.classList.add('active');
  selectedStatus = el.dataset.val;
}

function saveRecord() {
  var name = document.getElementById('fName').value.trim();
  if (!name) { showToast('åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); document.getElementById('fName').focus(); return; }

  // ä½“é¨“ç‰ˆï¼šä»¶æ•°åˆ¶é™
  if (IS_TRIAL && STATE.totalSaved >= MAX_RECORDS) {
    openTrialLock();
    return;
  }

  var record = {
    id:         Date.now(),
    date:       document.getElementById('fDate').value || today(),
    name:       name,
    status:     selectedStatus,
    topic:      document.getElementById('fTopic').value.trim(),
    reflection: document.getElementById('fReflection').value.trim(),
    action:     document.getElementById('fAction').value.trim(),
  };

  STATE.records.unshift(record);
  if (IS_TRIAL) STATE.totalSaved++;
  saveState();
  clearForm();
  renderRecent();
  updateLimitBar();
  showToast('âœ… è¨˜éŒ²ã—ã¾ã—ãŸ');
}

function clearForm() {
  document.getElementById('fName').value = '';
  document.getElementById('fTopic').value = '';
  document.getElementById('fReflection').value = '';
  document.getElementById('fAction').value = '';
  document.getElementById('fDate').value = today();
  selectStatus(document.querySelector('.sc-genki'));
}

function deleteRecord(id) {
  if (!confirm('ã“ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
  STATE.records = STATE.records.filter(function(r){ return r.id !== id; });
  saveState();
  renderRecent();
  renderList();
}

/* â•â•â•â•â•â•â•â•â•â• ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° â•â•â•â•â•â•â•â•â•â• */
var statusMeta = {
  'å…ƒæ°—':      { cls:'es-genki',  badge:'eb-genki',  icon:'ğŸ˜Š' },
  'ç–²ã‚Œã¦ã„ã‚‹': { cls:'es-tired',  badge:'eb-tired',  icon:'ğŸ˜”' },
  'è¡¨æƒ…ãŒä¹ã—ã„':{ cls:'es-flat',  badge:'eb-flat',   icon:'ğŸ˜¶' },
  'ã‚ã‹ã‚‰ãªã„':  { cls:'es-unknown',badge:'eb-unknown',icon:'ğŸ¤”' },
};

function buildEntryCard(r, showDel) {
  var meta  = statusMeta[r.status] || statusMeta['ã‚ã‹ã‚‰ãªã„'];
  var card  = document.createElement('div');
  card.className = 'entry-card';
  var stripe = document.createElement('div');
  stripe.className = 'entry-stripe ' + meta.cls;
  card.appendChild(stripe);

  var topDate = r.date ? r.date.replace(/-/g, '/') : '';
  var badge = '<span class="entry-status-badge ' + meta.badge + '">' + meta.icon + ' ' + r.status + '</span>';
  var topic = r.topic ? '<strong>è©±ã—ãŸå†…å®¹</strong>' + esc(r.topic) : '';
  var refl  = r.reflection ? '<strong>æ„Ÿã˜ãŸã“ã¨</strong>' + esc(r.reflection) : '';
  var act   = r.action ? '<strong>æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</strong>' + esc(r.action) : '';
  var del   = showDel ? '<button class="entry-del" onclick="deleteRecord(' + r.id + ')">ğŸ—‘ï¸</button>' : '';

  card.innerHTML += del +
    '<div class="entry-top">' +
      '<div class="entry-name">' + esc(r.name) + '</div>' +
      '<div class="entry-date">' + topDate + '</div>' +
    '</div>' +
    badge +
    '<div class="entry-body">' + topic + refl + act + '</div>';

  return card;
}

function renderRecent() {
  var el = document.getElementById('recentList');
  if (!el) return;
  var recent = STATE.records.slice(0, 3);
  if (!recent.length) {
    el.innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ“</div><div class="empty-text">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“<br>æœ€åˆã®å¯¾è©±ã‚’è¨˜éŒ²ã—ã¦ã¿ã¾ã—ã‚‡ã†</div></div>';
    return;
  }
  el.innerHTML = '';
  recent.forEach(function(r){ el.appendChild(buildEntryCard(r, true)); });
}

var currentFilter = 'all';

function setFilter(el) {
  document.querySelectorAll('.filter-chip').forEach(function(c){ c.classList.remove('active'); });
  el.classList.add('active');
  currentFilter = el.dataset.filter;
  renderList();
}

function renderList() {
  var el = document.getElementById('fullList');
  if (!el) return;
  var q = (document.getElementById('searchInput').value || '').toLowerCase();
  var list = STATE.records.filter(function(r){
    if (currentFilter !== 'all' && r.status !== currentFilter) return false;
    if (q && !((r.name + r.topic + r.reflection + r.action).toLowerCase().includes(q))) return false;
    return true;
  });
  if (!list.length) {
    el.innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ”</div><div class="empty-text">è©²å½“ã™ã‚‹è¨˜éŒ²ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div></div>';
    return;
  }
  el.innerHTML = '';
  list.forEach(function(r){ el.appendChild(buildEntryCard(r, true)); });
}

function renderInsight() {
  var records = STATE.records;
  // â”€â”€ åˆ†å¸ƒãƒãƒ¼
  var counts = {'å…ƒæ°—':0,'ç–²ã‚Œã¦ã„ã‚‹':0,'è¡¨æƒ…ãŒä¹ã—ã„':0,'ã‚ã‹ã‚‰ãªã„':0};
  records.forEach(function(r){ if (counts[r.status] !== undefined) counts[r.status]++; });
  var total = records.length || 1;
  var bar = document.getElementById('distBar');
  if (bar) {
    bar.innerHTML =
      '<div class="dist-seg" style="flex:' + counts['å…ƒæ°—']    + ';background:var(--sage);min-width:' + (counts['å…ƒæ°—']    ?4:0) + 'px"></div>' +
      '<div class="dist-seg" style="flex:' + counts['ç–²ã‚Œã¦ã„ã‚‹'] + ';background:var(--amber);min-width:' + (counts['ç–²ã‚Œã¦ã„ã‚‹']?4:0) + 'px"></div>' +
      '<div class="dist-seg" style="flex:' + counts['è¡¨æƒ…ãŒä¹ã—ã„'] + ';background:var(--blush);min-width:' + (counts['è¡¨æƒ…ãŒä¹ã—ã„']?4:0) + 'px"></div>' +
      '<div class="dist-seg" style="flex:' + counts['ã‚ã‹ã‚‰ãªã„'] + ';background:var(--ink4);min-width:'  + (counts['ã‚ã‹ã‚‰ãªã„']?4:0) + 'px"></div>';
  }
  // â”€â”€ å†…è¨³ãƒ†ã‚­ã‚¹ãƒˆ
  var rows = document.getElementById('insightRows');
  if (rows) {
    if (!records.length) { rows.innerHTML = '<div class="insight-empty">è¨˜éŒ²ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</div>'; return; }
    rows.innerHTML =
      mkRow('#5a7a5a','ğŸ˜Š å…ƒæ°—',counts['å…ƒæ°—'],total) +
      mkRow('#b8781a','ğŸ˜” ç–²ã‚Œã¦ã„ã‚‹',counts['ç–²ã‚Œã¦ã„ã‚‹'],total) +
      mkRow('#c87880','ğŸ˜¶ è¡¨æƒ…ãŒä¹ã—ã„',counts['è¡¨æƒ…ãŒä¹ã—ã„'],total) +
      mkRow('#9a8878','ğŸ¤” ã‚ã‹ã‚‰ãªã„',counts['ã‚ã‹ã‚‰ãªã„'],total);
  }
  // â”€â”€ ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—å€™è£œï¼ˆã€Œç–²ã‚Œã¦ã„ã‚‹ã€ã€Œè¡¨æƒ…ãŒä¹ã—ã„ã€æœ€æ–°3ä»¶ï¼‰
  var fu = records.filter(function(r){ return r.status==='ç–²ã‚Œã¦ã„ã‚‹' || r.status==='è¡¨æƒ…ãŒä¹ã—ã„'; }).slice(0,3);
  var fuEl = document.getElementById('followUpList');
  if (fuEl) {
    if (!fu.length) { fuEl.innerHTML = '<div class="insight-empty">è©²å½“ãªã— ğŸ‘</div>'; }
    else {
      fuEl.innerHTML = '';
      fu.forEach(function(r){ fuEl.appendChild(buildEntryCard(r, false)); });
    }
  }
  // â”€â”€ æœ€å¾Œã®è¨˜éŒ²ã‹ã‚‰7æ—¥è¶…ã®äºº
  var lastMap = {};
  records.forEach(function(r){
    if (!lastMap[r.name] || r.date > lastMap[r.name]) lastMap[r.name] = r.date;
  });
  var now = today();
  var stale = Object.entries(lastMap).filter(function(e){
    var diff = (new Date(now) - new Date(e[1])) / 86400000;
    return diff >= 7;
  }).sort(function(a,b){ return a[1] < b[1] ? -1 : 1; });
  var staleEl = document.getElementById('staleList');
  if (staleEl) {
    if (!stale.length) { staleEl.innerHTML = '<div class="insight-empty">å…¨å“¡æœ€è¿‘è¨˜éŒ²ãŒã‚ã‚Šã¾ã™ ğŸ‘</div>'; }
    else {
      staleEl.innerHTML = stale.map(function(e){
        var days = Math.floor((new Date(now) - new Date(e[1])) / 86400000);
        return '<div class="insight-row"><div class="insight-dot" style="background:var(--amber)"></div><span style="font-weight:700">' + esc(e[0]) + '</span><span style="color:var(--ink4);font-size:0.75rem">æœ€çµ‚è¨˜éŒ² ' + days + 'æ—¥å‰</span></div>';
      }).join('');
    }
  }
}

function mkRow(color, label, count, total) {
  return '<div class="insight-row">' +
    '<div class="insight-dot" style="background:' + color + '"></div>' +
    '<span>' + label + '</span>' +
    '<span style="margin-left:auto;font-weight:700;color:' + color + '">' + count + 'ä»¶</span>' +
    '<span style="color:var(--ink4);font-size:0.75rem;width:36px;text-align:right">' + Math.round(count/total*100) + '%</span>' +
  '</div>';
}

/* â•â•â•â•â•â•â•â•â•â• å®‰å¿ƒã‚«ãƒ¼ãƒ‰ â•â•â•â•â•â•â•â•â•â• */
function renderTrustCard() {
  var el = document.getElementById('trustCardPreview');
  if (!el) return;
  var title   = STATE.cardTitle;
  var message = STATE.cardMessage;
  var name    = STATE.myName || 'ã‚ãŸã—';
  var role    = STATE.myRole  || '';
  var team    = STATE.teamName ? 'ï¼ˆ' + STATE.teamName + 'ï¼‰' : '';
  el.innerHTML =
    '<div class="trust-card-title">ğŸ¤ ' + esc(title) + '</div>' +
    '<p style="font-size:0.82rem;color:var(--ink2);margin-bottom:12px;line-height:1.8;">' + esc(message) + '</p>' +
    '<div class="trust-item"><span class="trust-check">âœ”</span><span>è©±ã—ã¦ãã‚ŒãŸå†…å®¹ã¯ã€ã‚ãªãŸã¸ã®ã‚µãƒãƒ¼ãƒˆä»¥å¤–ã«ã¯ä½¿ã„ã¾ã›ã‚“</span></div>' +
    '<div class="trust-item"><span class="trust-check">âœ”</span><span>è©±ã—ãŸããªã„ã“ã¨ã¯ã€ç„¡ç†ã«è©±ã•ãªãã¦å¤§ä¸ˆå¤«ã§ã™</span></div>' +
    '<div class="trust-item"><span class="trust-check">âœ”</span><span>è¨˜éŒ²ã¯ã“ã®ç«¯æœ«ã«ã®ã¿ä¿å­˜ã•ã‚Œã€å¤–éƒ¨ã«ã¯é€ã‚‰ã‚Œã¾ã›ã‚“</span></div>' +
    '<div class="trust-item"><span class="trust-check">âœ”</span><span>è©•ä¾¡ã‚„æŸ»å®šãªã©ã«ä½¿ã‚ã‚Œã‚‹ã“ã¨ã¯ä¸€åˆ‡ã‚ã‚Šã¾ã›ã‚“</span></div>' +
    '<p style="font-size:0.72rem;color:var(--ink4);margin-top:14px;border-top:1px dashed var(--border);padding-top:10px;">' + esc(name) + (role ? 'ï¼ˆ' + esc(role) + 'ï¼‰' : '') + esc(team) + '</p>';
}

function updateTrustCard() {
  STATE.cardTitle   = document.getElementById('cardTitle').value.trim() || STATE.cardTitle;
  STATE.cardMessage = document.getElementById('cardMessage').value.trim() || STATE.cardMessage;
  saveState();
  renderTrustCard();
  showToast('âœ… ã‚«ãƒ¼ãƒ‰ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
}

function copyTrustCard() {
  var text = STATE.cardTitle + '\n\n' + STATE.cardMessage +
    '\n\nâœ” è©±ã—ã¦ãã‚ŒãŸå†…å®¹ã¯ã€ã‚ãªãŸã¸ã®ã‚µãƒãƒ¼ãƒˆä»¥å¤–ã«ã¯ä½¿ã„ã¾ã›ã‚“' +
    '\nâœ” è©±ã—ãŸããªã„ã“ã¨ã¯ã€ç„¡ç†ã«è©±ã•ãªãã¦å¤§ä¸ˆå¤«ã§ã™' +
    '\nâœ” è¨˜éŒ²ã¯ã“ã®ç«¯æœ«ã«ã®ã¿ä¿å­˜ã•ã‚Œã€å¤–éƒ¨ã«ã¯é€ã‚‰ã‚Œã¾ã›ã‚“' +
    '\nâœ” è©•ä¾¡ã‚„æŸ»å®šãªã©ã«ä½¿ã‚ã‚Œã‚‹ã“ã¨ã¯ä¸€åˆ‡ã‚ã‚Šã¾ã›ã‚“' +
    '\n\n' + STATE.myName + (STATE.myRole ? 'ï¼ˆ' + STATE.myRole + 'ï¼‰' : '');
  navigator.clipboard.writeText(text).then(function(){
    showToast('ğŸ“‹ ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
  }).catch(function(){
    var ta = document.createElement('textarea');
    ta.value = text; document.body.appendChild(ta);
    ta.select(); document.execCommand('copy');
    document.body.removeChild(ta);
    showToast('ğŸ“‹ ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
  });
}

function printTrustCard() {
  var w = window.open('', '', 'width=640,height=900');
  w.document.write('<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><title>å®‰å¿ƒã‚«ãƒ¼ãƒ‰</title><style>body{font-family:sans-serif;padding:40px;background:white;color:#2c2318;} .card{border:2px solid #e0d4c0;border-radius:16px;padding:28px;max-width:420px;margin:auto;} h2{color:#5a7a5a;font-size:1.1rem;margin-bottom:14px;} p{font-size:0.88rem;line-height:1.8;margin-bottom:14px;} .item{display:flex;gap:8px;margin-bottom:8px;font-size:0.85rem;} .check{color:#5a7a5a;} .footer{font-size:0.72rem;color:#9a8878;margin-top:18px;border-top:1px dashed #e0d4c0;padding-top:10px;}</style></head><body><div class="card">');
  w.document.write('<h2>ğŸ¤ ' + esc(STATE.cardTitle) + '</h2>');
  w.document.write('<p>' + esc(STATE.cardMessage) + '</p>');
  ['è©±ã—ã¦ãã‚ŒãŸå†…å®¹ã¯ã€ã‚ãªãŸã¸ã®ã‚µãƒãƒ¼ãƒˆä»¥å¤–ã«ã¯ä½¿ã„ã¾ã›ã‚“',
   'è©±ã—ãŸããªã„ã“ã¨ã¯ã€ç„¡ç†ã«è©±ã•ãªãã¦å¤§ä¸ˆå¤«ã§ã™',
   'è¨˜éŒ²ã¯ã“ã®ç«¯æœ«ã«ã®ã¿ä¿å­˜ã•ã‚Œã€å¤–éƒ¨ã«ã¯é€ã‚‰ã‚Œã¾ã›ã‚“',
   'è©•ä¾¡ã‚„æŸ»å®šãªã©ã«ä½¿ã‚ã‚Œã‚‹ã“ã¨ã¯ä¸€åˆ‡ã‚ã‚Šã¾ã›ã‚“'].forEach(function(t){
    w.document.write('<div class="item"><span class="check">âœ”</span><span>' + t + '</span></div>');
  });
  w.document.write('<div class="footer">' + esc(STATE.myName) + (STATE.myRole ? 'ï¼ˆ' + esc(STATE.myRole) + 'ï¼‰' : '') + '</div>');
  w.document.write('</div></body></html>');
  w.document.close(); w.print();
}

/* â•â•â•â•â•â•â•â•â•â• CSV â•â•â•â•â•â•â•â•â•â• */
function downloadCSV() {
  if (IS_TRIAL) { openTrialLock(); return; }
  if (!STATE.records.length) { showToast('è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“'); return; }
  var BOM = '\uFEFF';
  var header = ['æ—¥ä»˜','åå‰','æ§˜å­','è©±ã—ãŸå†…å®¹','æ„Ÿã˜ãŸã“ã¨','æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³'];
  var rows = STATE.records.map(function(r){
    return [r.date, r.name, r.status, r.topic, r.reflection, r.action].map(function(v){
      return '"' + (v||'').replace(/"/g,'""') + '"';
    }).join(',');
  });
  var csv = BOM + header.join(',') + '\n' + rows.join('\n');
  var blob = new Blob([csv], {type:'text/csv;charset=utf-8'});
  var a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'kokoLog_' + today() + '.csv';
  a.click();
}

/* â•â•â•â•â•â•â•â•â•â• è¨­å®š â•â•â•â•â•â•â•â•â•â• */
function showSettings() {
  document.getElementById('setMyName').textContent = STATE.myName;
  document.getElementById('setMyRole').textContent = STATE.myRole;
  document.getElementById('setTeamName').textContent = STATE.teamName || 'æœªè¨­å®š';
  document.getElementById('setRecordCount').textContent = STATE.records.length + 'ä»¶ï¼ˆç´¯è¨ˆä¿å­˜ï¼š' + (STATE.totalSaved || 0) + 'å› / ä¸Šé™' + MAX_RECORDS + 'å›ï¼‰';
  document.getElementById('settingsModal').style.display = 'flex';
}

function hideSettings() {
  document.getElementById('settingsModal').style.display = 'none';
}

function resetApp() {
  if (!confirm('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) return;
  localStorage.removeItem(STORAGE_KEY);
  localStorage.removeItem('kokoLog_guideSkip');
  location.reload();
}

/* â•â•â•â•â•â•â•â•â•â• TOAST â•â•â•â•â•â•â•â•â•â• */
var toastTimer;
function showToast(msg) {
  var el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(function(){ el.classList.remove('show'); }, 2000);
}

/* â•â•â•â•â•â•â•â•â•â• åˆå›ã‚¬ã‚¤ãƒ‰ â•â•â•â•â•â•â•â•â•â• */
function updateGuideText() {
  var n = document.getElementById('guideUserName');
  var t = document.getElementById('guideTeam');
  if (n) n.textContent = STATE.myName || 'ã‚ãªãŸ';
  if (t) t.textContent = STATE.teamName ? STATE.teamName + 'ã®ã¿ãªã•ã‚“' : 'ãƒãƒ¼ãƒ ã®ã¿ãªã•ã‚“';
}
function closeGuide() {
  var g = document.getElementById('welcomeGuide');
  if (g) { g.style.opacity = '0'; g.style.transition = 'opacity 0.3s'; setTimeout(function(){ g.style.display = 'none'; }, 300); }
}
function skipGuideForever(cb) {
  if (cb.checked) localStorage.setItem('kokoLog_guideSkip', '1');
  else localStorage.removeItem('kokoLog_guideSkip');
}

/* â•â•â•â•â•â•â•â•â•â• TRIAL LOCK â•â•â•â•â•â•â•â•â•â• */
function updateLimitBar() {
  // totalSaved ãƒ™ãƒ¼ã‚¹ï¼ˆå‰Šé™¤ã—ã¦ã‚‚å·»ãæˆ»ã‚‰ãªã„ï¼‰
  var n = IS_TRIAL ? STATE.totalSaved : STATE.records.length;
  var el = document.getElementById('limitCount');
  if (el) el.textContent = n + ' / ' + MAX_RECORDS + 'ä»¶';
  // ãƒ‰ãƒƒãƒˆæ¼”å‡ºï¼š1ä»¶ç›®ç‚¹ç¯ â†’ 2ä»¶ç›®ç‚¹ç¯ â†’ 3ä»¶ç›®ã§èµ¤å¤‰
  for (var i = 1; i <= MAX_RECORDS; i++) {
    var dot = document.getElementById('dot' + i);
    if (!dot) continue;
    if (i <= n) {
      dot.className = n >= MAX_RECORDS ? 'rld locked' : 'rld filled';
    } else {
      dot.className = 'rld';
    }
  }
  // ãƒãƒ¼èµ¤å¤‰
  if (n >= MAX_RECORDS) {
    var bar = document.getElementById('limitBar');
    if (bar) {
      bar.style.background = 'var(--blush-lt)';
      bar.style.borderColor = 'rgba(200,120,128,0.3)';
      var lbl = bar.querySelector('.record-limit-label');
      if (lbl) { lbl.textContent = 'ä½“é¨“ç‰ˆã®ä¸Šé™ã«é”ã—ã¾ã—ãŸ'; lbl.style.color = 'var(--blush)'; }
    }
  }
}

function openTrialLock() {
  document.getElementById('trialLock').style.display = 'flex';
}

/* â•â•â•â•â•â•â•â•â•â• UTIL â•â•â•â•â•â•â•â•â•â• */
function esc(s) {
  return (s || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'<br>');
}
</script>
<!-- â•â• TRIAL LOCK MODAL â•â• -->
<div id="trialLock" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:9999;align-items:center;justify-content:center;padding:24px;">
  <div style="background:white;padding:32px 28px 26px;border-radius:22px;max-width:420px;width:100%;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,0.35);position:relative;overflow:hidden;">
    <div style="position:absolute;top:0;left:0;right:0;height:5px;background:linear-gradient(90deg,#4a6a4a,#6a8e6a,#8aae8a);border-radius:22px 22px 0 0;"></div>
    <div style="font-size:2.4rem;margin-bottom:12px;">ğŸ”’</div>
    <h3 style="font-family:'Kaisei Tokumin',serif;font-size:1.1rem;font-weight:700;color:#2c2318;margin-bottom:8px;">ã“ã®å…ˆã¯Customç‰ˆã§è§£æ”¾ã•ã‚Œã¾ã™</h3><p style="font-size:0.78rem;color:#9a8878;margin-bottom:14px;line-height:1.7;">ä½“é¨“ç‰ˆã§ã¯<strong style="color:#2c2318;">ç´¯è¨ˆ3å›ã®ä¿å­˜</strong>ã¾ã§ã§ã™ã€‚<br>å‰Šé™¤ã—ã¦ã‚‚ä¿å­˜å›æ•°ã¯æˆ»ã‚Šã¾ã›ã‚“ã€‚</p>
    <ul style="text-align:left;font-size:0.85rem;list-style:none;background:#f5f7f3;border-radius:12px;padding:14px 18px;margin-bottom:20px;display:flex;flex-direction:column;gap:8px;">
      <li style="display:flex;align-items:center;gap:8px;color:#2c2318;"><span style="color:#4a6a4a;font-weight:700;">âœ”</span>è¨˜éŒ²ç„¡åˆ¶é™</li>
      <li style="display:flex;align-items:center;gap:8px;color:#2c2318;"><span style="color:#4a6a4a;font-weight:700;">âœ”</span>ãƒãƒ¼ãƒ åˆ†æ</li>
      <li style="display:flex;align-items:center;gap:8px;color:#2c2318;"><span style="color:#4a6a4a;font-weight:700;">âœ”</span>CSVå‡ºåŠ›</li>
      <li style="display:flex;align-items:center;gap:8px;color:#2c2318;"><span style="color:#4a6a4a;font-weight:700;">âœ”</span>å°åˆ·å…±æœ‰</li>
    </ul>
    <div style="font-size:0.78rem;color:#9a8878;font-weight:700;margin-bottom:16px;">ç¾å ´ã§æœ¬æ°—ã§ä½¿ã†æ–¹ã¸ â†’ Customç‰ˆã¸</div>
    <a href="LPã®URL" style="display:block;background:linear-gradient(135deg,#4a6a4a,#6a8e6a);color:white;padding:13px 20px;border-radius:999px;text-decoration:none;font-size:0.92rem;font-weight:700;box-shadow:0 4px 18px rgba(74,106,74,0.35);">ğŸŒ± Customç‰ˆã®è©³ç´°ã‚’è¦‹ã‚‹</a>
    <button onclick="document.getElementById('trialLock').style.display='none'" style="margin-top:12px;background:none;border:none;font-size:0.75rem;color:#c8b89a;cursor:pointer;display:block;width:100%;">é–‰ã˜ã‚‹ï¼ˆä½“é¨“ç‰ˆã«æˆ»ã‚‹ï¼‰</button>
  </div>
</div>

</body>
</html>
