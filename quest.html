<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸŒŸ Life Quest Board</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.3.1/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.3.1/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.25.6/babel.min.js"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&family=Kaisei+Decol:wght@400;700&display=swap" rel="stylesheet">

  <style>
    /* â•â•â•â•â•â•â•â•â•â• Design Tokens â•â•â•â•â•â•â•â•â•â• */
    :root {
      --sky:      #e8f4fd;
      --sky2:     #d0eaf9;
      --peach:    #fdecd4;
      --peach2:   #fbd9b0;
      --mint:     #d4f4e8;
      --lemon:    #fef9c3;
      --lavender: #ede9fe;
      --rose:     #fce7f0;

      --primary:  #5b8dee;   /* ã‚³ãƒ¼ãƒ³ãƒ•ãƒ©ãƒ¯ãƒ¼ãƒ–ãƒ«ãƒ¼ */
      --primary2: #3b73d8;
      --accent:   #f97316;   /* ã‚ªãƒ¬ãƒ³ã‚¸ */
      --accent2:  #ea580c;
      --pink:     #f472b6;
      --green:    #34d399;
      --yellow:   #fbbf24;
      --purple:   #a78bfa;

      --ink:      #2d2a42;
      --ink2:     #5a5677;
      --ink3:     #9590b0;

      --white:    #ffffff;
      --card:     rgba(255,255,255,0.82);
      --border:   rgba(91,141,238,0.18);

      --radius-xl: 28px;
      --radius-lg: 20px;
      --radius-md: 14px;

      --shadow-soft: 0 4px 24px rgba(91,141,238,0.13), 0 1px 4px rgba(0,0,0,0.06);
      --shadow-card: 0 8px 32px rgba(91,141,238,0.16), 0 2px 8px rgba(0,0,0,0.07);
      --shadow-pop:  0 16px 48px rgba(91,141,238,0.22), 0 4px 12px rgba(0,0,0,0.1);
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }

    body {
      font-family: 'Nunito', 'Kaisei Decol', sans-serif;
      background: linear-gradient(160deg, #e8f4fd 0%, #fdecd4 40%, #fce7f0 75%, #ede9fe 100%);
      min-height: 100vh;
      color: var(--ink);
      overflow-x: hidden;
    }

    /* èƒŒæ™¯ã®æµ®ã‹ã¶å†† */
    body::before {
      content: '';
      position: fixed; inset: 0; z-index: 0; pointer-events: none;
      background:
        radial-gradient(circle 280px at 8% 15%,  rgba(91,141,238,0.10) 0%, transparent 70%),
        radial-gradient(circle 220px at 92% 10%,  rgba(244,114,182,0.12) 0%, transparent 70%),
        radial-gradient(circle 300px at 85% 80%,  rgba(167,139,250,0.10) 0%, transparent 70%),
        radial-gradient(circle 200px at 5%  85%,  rgba(52,211,153,0.10) 0%, transparent 70%),
        radial-gradient(circle 180px at 50% 50%,  rgba(251,191,36,0.06) 0%, transparent 70%);
    }

    /* â•â•â•â•â•â•â•â•â•â• ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”»é¢ â•â•â•â•â•â•â•â•â•â• */
    #pw-overlay {
      position: fixed; inset: 0; z-index: 9999;
      display: flex; align-items: center; justify-content: center; padding: 20px;
      background: linear-gradient(135deg, #c7dcf8 0%, #f7d9e8 50%, #dfd6f9 100%);
      transition: opacity 0.5s ease, visibility 0.5s;
    }
    #pw-overlay.hide { opacity: 0; visibility: hidden; }

    .pw-card {
      background: var(--white);
      border-radius: var(--radius-xl);
      padding: 48px 36px 40px;
      max-width: 380px; width: 100%;
      text-align: center;
      box-shadow: var(--shadow-pop);
      position: relative; overflow: hidden;
    }
    .pw-card::before {
      content: '';
      position: absolute; top: 0; left: 0; right: 0; height: 6px;
      background: linear-gradient(90deg, var(--primary), var(--pink), var(--yellow), var(--green));
      border-radius: var(--radius-xl) var(--radius-xl) 0 0;
    }

    .pw-mascot { font-size: 4.5rem; margin-bottom: 8px; display: block; animation: bounce-gentle 2.4s ease-in-out infinite; }
    .pw-title  { font-size: 1.5rem; font-weight: 900; color: var(--ink); margin-bottom: 4px; }
    .pw-sub    { font-size: 0.82rem; color: var(--ink3); margin-bottom: 32px; }
    .pw-label  { font-size: 0.75rem; font-weight: 800; color: var(--ink2); letter-spacing: 0.1em; text-transform: uppercase; display: block; text-align: left; margin-bottom: 8px; }

    .pw-input {
      width: 100%; padding: 14px 18px;
      border: 2.5px solid #e0d8f5;
      border-radius: var(--radius-md);
      font-family: 'Nunito', sans-serif;
      font-size: 1.1rem; font-weight: 700;
      color: var(--ink); background: var(--lavender);
      outline: none; text-align: center; letter-spacing: 0.18em;
      transition: border-color 0.2s, box-shadow 0.2s;
      margin-bottom: 16px;
    }
    .pw-input:focus { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(91,141,238,0.15); }
    .pw-input.error { border-color: var(--pink); animation: shake 0.38s; }

    .pw-btn {
      width: 100%; padding: 15px;
      background: linear-gradient(135deg, var(--primary), var(--purple));
      color: white; border: none; border-radius: var(--radius-md);
      font-family: 'Nunito', sans-serif; font-size: 1rem; font-weight: 900;
      cursor: pointer; letter-spacing: 0.05em;
      box-shadow: 0 6px 0 var(--primary2), 0 10px 24px rgba(91,141,238,0.3);
      transition: transform 0.15s, box-shadow 0.15s;
    }
    .pw-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 0 var(--primary2), 0 14px 28px rgba(91,141,238,0.35); }
    .pw-btn:active { transform: translateY(4px); box-shadow: 0 2px 0 var(--primary2); }

    .pw-error { margin-top: 12px; font-size: 0.8rem; font-weight: 700; color: #e05a80; min-height: 20px; }

    /* â•â•â•â•â•â•â•â•â•â• ã‚¢ãƒ—ãƒªæœ¬ä½“ â•â•â•â•â•â•â•â•â•â• */
    #app {
      position: relative; z-index: 1;
      max-width: 480px; margin: 0 auto;
      padding: 28px 18px 100px;
      opacity: 0; transform: translateY(20px);
      transition: opacity 0.5s ease 0.1s, transform 0.5s ease 0.1s;
    }
    #app.visible { opacity: 1; transform: translateY(0); }

    /* â”€â”€ ãƒ˜ãƒƒãƒ€ãƒ¼ â”€â”€ */
    .app-header {
      display: flex; justify-content: space-between; align-items: flex-start;
      margin-bottom: 24px; padding: 0 4px;
    }
    .logo-area {}
    .logo-title {
      font-size: 1.5rem; font-weight: 900; color: var(--primary);
      display: flex; align-items: center; gap: 6px; line-height: 1;
    }
    .logo-sub { font-size: 0.72rem; font-weight: 700; color: var(--ink3); letter-spacing: 0.12em; margin-top: 3px; }

    .header-btns { display: flex; gap: 8px; }
    .hbtn {
      padding: 9px 16px; border: none; border-radius: var(--radius-md);
      font-family: 'Nunito', sans-serif; font-size: 0.78rem; font-weight: 800;
      cursor: pointer; display: flex; align-items: center; gap: 5px;
      transition: transform 0.15s, box-shadow 0.15s;
      box-shadow: var(--shadow-soft);
    }
    .hbtn:active { transform: scale(0.96); }
    .hbtn-consult { background: linear-gradient(135deg, #f9a8d4, #f472b6); color: white; box-shadow: 0 4px 0 #db2777; }
    .hbtn-consult:active { box-shadow: 0 1px 0 #db2777 !important; transform: translateY(3px); }
    .hbtn-print   { background: linear-gradient(135deg, #c7d2fe, var(--purple)); color: white; box-shadow: 0 4px 0 #7c3aed; }
    .hbtn-print:active { box-shadow: 0 1px 0 #7c3aed !important; transform: translateY(3px); }
    .hbtn-locked  { background: #fce7f0; color: #f9a8d4; cursor: not-allowed; box-shadow: none; }

    /* â”€â”€ ãƒ¬ãƒ™ãƒ«ã‚«ãƒ¼ãƒ‰ â”€â”€ */
    .level-card {
      background: var(--card);
      border-radius: var(--radius-xl);
      padding: 24px 26px 20px;
      border: 2px solid var(--border);
      box-shadow: var(--shadow-card);
      margin-bottom: 20px;
      position: relative; overflow: hidden;
    }
    .level-card::after {
      content: 'â­';
      position: absolute; right: -10px; top: -14px;
      font-size: 5rem; opacity: 0.07; transform: rotate(15deg);
      pointer-events: none;
    }
    .level-row   { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 10px; }
    .level-num   { font-size: 2.2rem; font-weight: 900; color: var(--primary); line-height: 1; }
    .level-label { font-size: 0.7rem; font-weight: 800; color: var(--ink3); letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 2px; }
    .streak-badge {
      background: linear-gradient(135deg, var(--lemon), #fde68a);
      color: #92400e; font-size: 0.78rem; font-weight: 900;
      padding: 5px 12px; border-radius: 99px;
      border: 2px solid #fbbf24;
      box-shadow: 0 2px 8px rgba(251,191,36,0.3);
    }
    .xp-bar-bg { background: #ede9fe; border-radius: 99px; height: 12px; overflow: hidden; }
    .xp-bar    { height: 100%; border-radius: 99px; background: linear-gradient(90deg, var(--primary), var(--pink)); transition: width 0.8s cubic-bezier(.4,0,.2,1); }
    .xp-labels { display: flex; justify-content: space-between; font-size: 0.68rem; font-weight: 700; color: var(--ink3); margin-top: 5px; }

    /* â”€â”€ ã‚¯ã‚¨ã‚¹ãƒˆã‚«ãƒ¼ãƒ‰ â”€â”€ */
    .quest-list { display: flex; flex-direction: column; gap: 12px; margin-bottom: 24px; }

    .quest-card {
      background: var(--card);
      border-radius: var(--radius-lg);
      padding: 18px 20px;
      border: 2.5px solid var(--border);
      box-shadow: var(--shadow-soft);
      display: flex; align-items: center; gap: 14px;
      cursor: pointer;
      transition: transform 0.18s, box-shadow 0.18s, opacity 0.3s, border-color 0.2s;
      -webkit-tap-highlight-color: transparent;
    }
    .quest-card:hover { transform: translateY(-3px) scale(1.01); box-shadow: var(--shadow-card); }
    .quest-card:active { transform: scale(0.98); }
    .quest-card.done { opacity: 0.52; }
    .quest-card.done .quest-title { text-decoration: line-through; color: var(--ink3); }

    .quest-icon-wrap {
      width: 52px; height: 52px; border-radius: 16px;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.7rem; flex-shrink: 0;
    }
    .quest-body  { flex: 1; min-width: 0; }
    .quest-title { font-size: 0.97rem; font-weight: 800; color: var(--ink); margin-bottom: 3px; }
    .quest-reward { font-size: 0.72rem; font-weight: 700; color: var(--accent); display: flex; align-items: center; gap: 3px; }

    .quest-check {
      width: 36px; height: 36px; border-radius: 50%; flex-shrink: 0;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.2rem;
      transition: transform 0.2s;
    }
    .quest-check.checked { transform: scale(1.15); }

    /* â”€â”€ ã²ã¨ã“ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ â”€â”€ */
    .bottom-msg {
      text-align: center; padding: 12px 20px;
      font-size: 0.82rem; font-weight: 700; color: var(--ink2);
      font-style: italic; line-height: 1.6;
    }

    /* â”€â”€ ãƒ¢ãƒ¼ãƒ€ãƒ« â”€â”€ */
    .modal-overlay {
      position: fixed; inset: 0; z-index: 500;
      background: rgba(45,42,66,0.55);
      backdrop-filter: blur(6px);
      display: flex; align-items: center; justify-content: center; padding: 16px;
    }
    .modal-box {
      background: white; border-radius: var(--radius-xl);
      width: 100%; max-width: 420px; max-height: 90vh; overflow-y: auto;
      padding: 32px 26px; position: relative;
      box-shadow: var(--shadow-pop);
      animation: pop-in 0.32s cubic-bezier(.34,1.56,.64,1);
    }
    .modal-box::-webkit-scrollbar { width: 4px; }
    .modal-box::-webkit-scrollbar-thumb { background: #e0d8f5; border-radius: 99px; }

    .modal-close {
      position: absolute; top: 18px; right: 20px;
      background: #f1f0f8; border: none; border-radius: 50%;
      width: 34px; height: 34px; cursor: pointer;
      font-size: 1rem; color: var(--ink2); font-weight: 900;
      display: flex; align-items: center; justify-content: center;
      transition: background 0.2s;
    }
    .modal-close:hover { background: #e0d8f5; }

    .modal-title { font-size: 1.2rem; font-weight: 900; color: var(--ink); margin-bottom: 4px; }
    .modal-sub   { font-size: 0.78rem; color: var(--ink3); font-weight: 600; margin-bottom: 20px; }

    /* â”€â”€ ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ï¼ˆã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ï¼‰ â”€â”€ */
    .wizard-progress { margin-bottom: 20px; }
    .wp-header { display: flex; justify-content: space-between; font-size: 0.7rem; font-weight: 800; color: var(--ink3); letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 6px; }
    .wp-bar-bg { background: #ede9fe; border-radius: 99px; height: 8px; overflow: hidden; margin-bottom: 10px; }
    .wp-bar    { height: 100%; border-radius: 99px; background: linear-gradient(90deg, var(--primary), var(--pink)); transition: width 0.4s; }
    .wp-steps  { display: flex; gap: 6px; }
    .wp-step   { flex: 1; padding: 6px 4px; border-radius: 10px; text-align: center; font-size: 0.68rem; font-weight: 800; border: 1.5px solid #e0d8f5; color: var(--ink3); transition: all 0.2s; }
    .wp-step.active { background: var(--lavender); border-color: var(--purple); color: var(--ink); }

    /* â”€â”€ ãƒ•ã‚©ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ â”€â”€ */
    .field-group { background: #faf9ff; border-radius: var(--radius-md); padding: 18px 16px; margin-bottom: 14px; border: 1.5px solid #e8e4f8; }
    .field-group-title { font-size: 0.82rem; font-weight: 900; color: var(--primary); margin-bottom: 12px; }
    .field-label { font-size: 0.68rem; font-weight: 800; color: var(--ink2); letter-spacing: 0.1em; text-transform: uppercase; display: block; margin-bottom: 6px; }
    .field-wrap { margin-bottom: 12px; }

    .form-input, .form-textarea {
      width: 100%; padding: 11px 14px;
      border: 2px solid #e0d8f5; border-radius: var(--radius-md);
      font-family: 'Nunito', sans-serif; font-size: 0.88rem; font-weight: 600;
      color: var(--ink); background: white; outline: none;
      transition: border-color 0.2s, box-shadow 0.2s; resize: none;
    }
    .form-input:focus, .form-textarea:focus {
      border-color: var(--primary); box-shadow: 0 0 0 3px rgba(91,141,238,0.12);
    }
    .form-input::placeholder, .form-textarea::placeholder { color: #c4bede; font-weight: 500; }

    /* â”€â”€ ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ â”€â”€ */
    .wizard-footer { display: flex; gap: 10px; margin-top: 20px; }
    .wbtn { flex: 1; padding: 13px; border: none; border-radius: var(--radius-md); font-family: 'Nunito', sans-serif; font-size: 0.88rem; font-weight: 900; cursor: pointer; transition: transform 0.15s, box-shadow 0.15s; }
    .wbtn-back { background: #f1f0f8; color: var(--ink2); }
    .wbtn-back:disabled { opacity: 0.35; cursor: not-allowed; }
    .wbtn-next { background: linear-gradient(135deg, var(--primary), var(--purple)); color: white; box-shadow: 0 5px 0 var(--primary2); }
    .wbtn-next:active { transform: translateY(3px); box-shadow: 0 2px 0 var(--primary2); }
    .wbtn-send { background: linear-gradient(135deg, var(--pink), #e11d48); color: white; box-shadow: 0 5px 0 #be123c; }
    .wbtn-send:active { transform: translateY(3px); box-shadow: 0 2px 0 #be123c; }

    .status-msg { text-align: center; font-size: 0.78rem; font-weight: 700; color: var(--pink); margin-top: 10px; min-height: 18px; }
    .form-note  { text-align: center; font-size: 0.7rem; color: var(--ink3); font-weight: 600; margin-top: 8px; line-height: 1.5; }

    /* â”€â”€ å°åˆ· â”€â”€ */
    @media print {
      #pw-overlay, .no-print { display: none !important; }
      body { background: white !important; }
      body::before { display: none; }
      .print-only { display: block !important; }
      #app { padding: 0; max-width: 100%; opacity: 1 !important; transform: none !important; }
    }
    .print-only { display: none; }

    /* â•â•â•â•â•â•â•â•â•â• Animations â•â•â•â•â•â•â•â•â•â• */
    @keyframes bounce-gentle {
      0%,100% { transform: translateY(0); }
      50%      { transform: translateY(-10px); }
    }
    @keyframes shake {
      0%,100% { transform: translateX(0); }
      20%      { transform: translateX(-7px); }
      60%      { transform: translateX(7px); }
    }
    @keyframes pop-in {
      from { opacity: 0; transform: scale(0.88) translateY(20px); }
      to   { opacity: 1; transform: scale(1) translateY(0); }
    }
    @keyframes fade-up {
      from { opacity: 0; transform: translateY(16px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .fade-up { animation: fade-up 0.45s ease both; }

    /* â”€â”€ ã‚¯ã‚¨ã‚¹ãƒˆã®è‰²ãƒ†ãƒ¼ãƒ â”€â”€ */
    .qc-blue   { background: #dbeafe; }
    .qc-peach  { background: #fef3c7; }
    .qc-mint   { background: #d1fae5; }
    .qc-rose   { background: #fce7f0; }
    .qc-lav    { background: #ede9fe; }

    /* cooldown */
    .cooldown-banner {
      background: #fef9c3; border: 2px solid #fbbf24; border-radius: var(--radius-md);
      padding: 10px 16px; font-size: 0.78rem; font-weight: 700; color: #92400e;
      margin-bottom: 16px; text-align: center;
    }
  </style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â• ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”»é¢ â•â•â•â•â•â•â•â•â•â• -->
<div id="pw-overlay">
  <div class="pw-card">
    <span class="pw-mascot">ğŸŒŸ</span>
    <h1 class="pw-title">Life Quest Board</h1>
    <p class="pw-sub">æ¯æ—¥ã¡ã‚‡ã£ã¨ãšã¤ã€ã„ã£ã—ã‚‡ã«æˆé•·ã—ã‚ˆã†ï¼</p>
    <label class="pw-label" for="pwInput">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
    <input class="pw-input" type="password" id="pwInput" placeholder="â—â—â—â—" autocomplete="off" />
    <button class="pw-btn" id="pwBtn">ã¯ã˜ã‚ã‚‹ âœ¨</button>
    <p class="pw-error" id="pwError"></p>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒª â•â•â•â•â•â•â•â•â•â• -->
<div id="app"></div>

<script type="text/babel">
const { useState, useMemo, useEffect } = React;

/* â”€â”€â”€ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒˆ â”€â”€â”€ */
(function() {
  const CORRECT = 'life';
  const overlay = document.getElementById('pw-overlay');
  const appEl   = document.getElementById('app');
  const input   = document.getElementById('pwInput');
  const btn     = document.getElementById('pwBtn');
  const errEl   = document.getElementById('pwError');

  let unlocked = false;

  function unlock() {
    if (unlocked) return;
    if (input.value === CORRECT) {
      unlocked = true;
      overlay.classList.add('hide');
      setTimeout(() => overlay.style.display = 'none', 550);
      appEl.classList.add('visible');
      renderApp();
    } else {
      input.classList.add('error');
      errEl.textContent = 'ã¡ãŒã†ã‚ˆï¼ã‚‚ã†ã„ã¡ã©è©¦ã—ã¦ã¿ã¦ ğŸ™ˆ';
      setTimeout(() => {
        input.classList.remove('error');
        input.value = '';
        errEl.textContent = '';
        input.focus();
      }, 500);
    }
  }

  btn.addEventListener('click', unlock);
  input.addEventListener('keydown', e => { if (e.key === 'Enter') unlock(); });
})();

/* â”€â”€â”€ ãƒ‡ãƒ¼ã‚¿ â”€â”€â”€ */
const CONSULT_KEY = 'lqb-last-consult-ym';

const getYM = (d = new Date()) =>
  `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;

const nextMonthLabel = (d = new Date()) => {
  const n = new Date(d.getFullYear(), d.getMonth()+1, 1);
  return `${n.getFullYear()}å¹´${n.getMonth()+1}æœˆ`;
};

const INITIAL_QUESTS = [
  { id:1, title:'æœã®æ·±å‘¼å¸',     icon:'ğŸ§˜', reward:'å¿ƒã®çµæ™¶',   done:false, color:'qc-blue'  },
  { id:2, title:'ã§ããŸã“ã¨ã‚’ãƒ¡ãƒ¢', icon:'ğŸ“', reward:'çŸ¥æµã®æ ',   done:false, color:'qc-peach' },
  { id:3, title:'å¤œã®è‡ªåˆ†è¤’ã‚',    icon:'ğŸ•¯ï¸', reward:'å®‰ã‚‰ãã®é›«', done:false, color:'qc-mint'  },
];

const WIZARD_STEPS = [
  { key:'traits', label:'ç‰¹æ€§' },
  { key:'issues', label:'èª²é¡Œ' },
  { key:'likes',  label:'å¥½ã' },
];

const BLANK_FORM = {
  reply_to:'', child_name:'',
  strengths:'', difficulties:'', communication:'',
  issues_life_learning:'', issues_social:'', top_priority:'',
  interests:'', motivators:'', relax_methods:'',
};

/* â”€â”€â”€ ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ â”€â”€â”€ */
function App() {
  const [quests, setQuests]         = useState(INITIAL_QUESTS);
  const [modalOpen, setModalOpen]   = useState(false);
  const [stepIndex, setStepIndex]   = useState(0);
  const [form, setForm]             = useState(BLANK_FORM);
  const [status, setStatus]         = useState('');
  const [cooldownMsg, setCooldownMsg] = useState('');

  const xp = quests.filter(q => q.done).length;

  const lockedThisMonth = useMemo(() => {
    try { return localStorage.getItem(CONSULT_KEY) === getYM(); } catch { return false; }
  }, [modalOpen, status]);

  const setField = (k, v) => setForm(p => ({ ...p, [k]: v }));

  /* â”€â”€ ã‚¯ã‚¨ã‚¹ãƒˆãƒˆã‚°ãƒ« â”€â”€ */
  const toggle = id => setQuests(p => p.map(q => q.id === id ? { ...q, done: !q.done } : q));

  /* â”€â”€ ãƒ¢ãƒ¼ãƒ€ãƒ«é–‹é–‰ â”€â”€ */
  const openModal = () => {
    if (lockedThisMonth) {
      setCooldownMsg(`ä»Šæœˆã®ç›¸è«‡ã¯é€ä¿¡æ¸ˆã¿ã§ã™ã€‚æ¬¡ã¯ ${nextMonthLabel()} ã‹ã‚‰ï¼`);
      return;
    }
    setCooldownMsg(''); setStatus(''); setStepIndex(0);
    setModalOpen(true);
  };
  const closeModal = () => { setModalOpen(false); setStatus(''); };

  /* â”€â”€ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ â”€â”€ */
  const validateStep = () => {
    if (!form.child_name.trim()) { setStatus('ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ï¼ˆå¿…é ˆï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return false; }
    if (WIZARD_STEPS[stepIndex].key === 'issues' && !form.top_priority.trim()) {
      setStatus('ä¸€ç•ªè§£æ±ºã—ãŸã„ã“ã¨ï¼ˆå¿…é ˆï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return false;
    }
    setStatus(''); return true;
  };

  const nextStep = () => { if (validateStep()) setStepIndex(i => Math.min(i+1, WIZARD_STEPS.length-1)); };
  const prevStep = () => { setStatus(''); setStepIndex(i => Math.max(i-1, 0)); };

  /* â”€â”€ é€ä¿¡ â”€â”€ */
  const submit = async e => {
    e.preventDefault();
    if (!form.child_name.trim()) { setStatus('ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ï¼ˆå¿…é ˆï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
    if (!form.top_priority.trim()) { setStatus('ä¸€ç•ªè§£æ±ºã—ãŸã„ã“ã¨ï¼ˆå¿…é ˆï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
    if (localStorage.getItem(CONSULT_KEY) === getYM()) {
      setStatus(`ä»Šæœˆåˆ†ã¯é€ä¿¡æ¸ˆã¿ã§ã™ã€‚æ¬¡ã¯ ${nextMonthLabel()} ã‹ã‚‰ï¼`); return;
    }
    setStatus('é€ä¿¡ä¸­...');
    const fd = new FormData();
    fd.append('access_key', '7bc32ddd-3f06-4464-b9af-1582137cfd91');
    fd.append('subject', 'ã€Premiumç›¸è«‡ã€‘ãƒ’ã‚¢ãƒªãƒ³ã‚°ãƒ•ã‚©ãƒ¼ãƒ ');
    Object.entries(form).forEach(([k,v]) => fd.append(k, v ?? ''));
    try {
      const res = await fetch('https://api.web3forms.com/submit', { method:'POST', body:fd });
      if (res.ok) {
        localStorage.setItem(CONSULT_KEY, getYM());
        setStatus('é€ä¿¡å®Œäº†ï¼è¿”ä¿¡ã‚’ãŠå¾…ã¡ãã ã•ã„ ğŸ’Œ');
        setTimeout(() => {
          closeModal();
          setCooldownMsg(`ä»Šæœˆã®ç›¸è«‡ã¯é€ä¿¡æ¸ˆã¿ã§ã™ã€‚æ¬¡ã¯ ${nextMonthLabel()} ã‹ã‚‰ï¼`);
          setForm(BLANK_FORM);
        }, 2600);
      } else { setStatus('é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ï¼‰'); }
    } catch { setStatus('é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸï¼ˆé€šä¿¡ã‚¨ãƒ©ãƒ¼ï¼‰'); }
  };

  /* â”€â”€â”€ ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰é€²æ—UI â”€â”€â”€ */
  const Progress = () => {
    const pct = Math.round((stepIndex+1) / WIZARD_STEPS.length * 100);
    return (
      <div className="wizard-progress">
        <div className="wp-header"><span>Step {stepIndex+1} / {WIZARD_STEPS.length}</span><span>{pct}%</span></div>
        <div className="wp-bar-bg"><div className="wp-bar" style={{width:`${pct}%`}}/></div>
        <div className="wp-steps">
          {WIZARD_STEPS.map((s,i) => (
            <div key={s.key} className={`wp-step ${i===stepIndex?'active':''}`}>{s.label}</div>
          ))}
        </div>
      </div>
    );
  };

  /* â”€â”€â”€ ã‚¹ãƒ†ãƒƒãƒ—1ï¼šç‰¹æ€§ â”€â”€â”€ */
  const StepTraits = () => (
    <div className="field-group">
      <div className="field-group-title">ğŸŒ± ãŠå­ã•ã‚“ã®ç‰¹æ€§ãƒ»å€‹æ€§</div>
      {[
        {key:'strengths',    label:'å¾—æ„ãªã“ã¨ãƒ»ã‚ˆãè¤’ã‚ã‚‰ã‚Œã‚‹ã“ã¨',          ph:'ä¾‹ï¼šæ‰‹å…ˆãŒå™¨ç”¨ã€è¨˜æ†¶åŠ›ãŒè‰¯ã„ã€æŒ¨æ‹¶ãŒã§ãã‚‹'},
        {key:'difficulties', label:'è‹¦æ‰‹ãªã“ã¨ãƒ»ã‚µãƒãƒ¼ãƒˆãŒå¿…è¦ãªå ´é¢',        ph:'ä¾‹ï¼šå¤§ããªéŸ³ãŒè‹¦æ‰‹ã€æ€¥ãªå¤‰æ›´ã§ãƒ‘ãƒ‹ãƒƒã‚¯'},
        {key:'communication',label:'ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ§˜å­',              ph:'ä¾‹ï¼šè‡ªåˆ†ã®æ°—æŒã¡ã‚’è¨€è‘‰ã«ã§ãã‚‹ã€è¦–ç·šãŒåˆã„ã«ãã„'},
      ].map(f => (
        <div key={f.key} className="field-wrap">
          <label className="field-label">{f.label}</label>
          <textarea className="form-textarea" rows={2} placeholder={f.ph}
            value={form[f.key]} onChange={e => setField(f.key, e.target.value)}/>
        </div>
      ))}
    </div>
  );

  /* â”€â”€â”€ ã‚¹ãƒ†ãƒƒãƒ—2ï¼šèª²é¡Œ â”€â”€â”€ */
  const StepIssues = () => (
    <div className="field-group">
      <div className="field-group-title">ğŸ” ä»Šã®å›°ã‚Šã”ã¨</div>
      {[
        {key:'issues_life_learning', label:'ç”Ÿæ´»ãƒ»å­¦ç¿’é¢ã§ã®å›°ã‚Šã”ã¨', ph:'ä¾‹ï¼šç€æ›¿ãˆã«æ™‚é–“ãŒã‹ã‹ã‚‹ã€é›†ä¸­åŠ›ãŒç¶šã‹ãªã„'},
        {key:'issues_social',        label:'å¯¾äººé–¢ä¿‚ãƒ»ç¤¾ä¼šæ€§ã§ã®å›°ã‚Šã”ã¨', ph:'ä¾‹ï¼šå‹é”ã¨ã®è·é›¢æ„ŸãŒè¿‘ã„ã€é †ç•ªå¾…ã¡ãŒé›£ã—ã„'},
        {key:'top_priority',         label:'ä¸€ç•ªè§£æ±ºã—ãŸã„ã“ã¨ï¼ˆå¿…é ˆï¼‰â˜…', ph:'å„ªå…ˆé †ä½ã‚’æ˜ç¢ºã«ã€è‡ªç”±ã«æ›¸ã„ã¦ãã ã•ã„', rows:3},
      ].map(f => (
        <div key={f.key} className="field-wrap">
          <label className="field-label">{f.label}</label>
          <textarea className="form-textarea" rows={f.rows||2} placeholder={f.ph}
            value={form[f.key]} onChange={e => setField(f.key, e.target.value)}/>
        </div>
      ))}
    </div>
  );

  /* â”€â”€â”€ ã‚¹ãƒ†ãƒƒãƒ—3ï¼šå¥½ã â”€â”€â”€ */
  const StepLikes = () => (
    <div className="field-group">
      <div className="field-group-title">ğŸ’› å¥½ããªã‚‚ã®ãƒ»ã‚„ã‚‹æ°—ã®ãƒ’ãƒ³ãƒˆ</div>
      {[
        {key:'interests',     label:'èˆˆå‘³ãƒ»é–¢å¿ƒãŒã‚ã‚‹ã‚‚ã®',           ph:'ä¾‹ï¼šé›»è»Šã€æç«œã€ãŠçµµæãã€ç‰¹å®šã‚­ãƒ£ãƒ©'},
        {key:'motivators',    label:'ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãŒä¸ŠãŒã‚‹å ±é…¬ãƒ»è¡Œå‹•', ph:'ä¾‹ï¼šã‚·ãƒ¼ãƒ«ãŒã‚‚ã‚‰ãˆã‚‹ã€é«˜ã„é«˜ã„ã€å¥½ããªéŸ³æ¥½'},
        {key:'relax_methods', label:'ãƒªãƒ©ãƒƒã‚¯ã‚¹ã§ãã‚‹æ–¹æ³•',           ph:'ä¾‹ï¼šæ¯›å¸ƒã«ãã‚‹ã¾ã‚‹ã€ç‹­ã„ã¨ã“ã‚ã«å…¥ã‚‹'},
      ].map(f => (
        <div key={f.key} className="field-wrap">
          <label className="field-label">{f.label}</label>
          <textarea className="form-textarea" rows={2} placeholder={f.ph}
            value={form[f.key]} onChange={e => setField(f.key, e.target.value)}/>
        </div>
      ))}
    </div>
  );

  /* â”€â”€â”€ ã‚¯ã‚¨ã‚¹ãƒˆã®è‰² â”€â”€â”€ */
  const questColors = ['qc-blue','qc-peach','qc-mint','qc-rose','qc-lav'];

  /* â”€â”€â”€ RENDER â”€â”€â”€ */
  return (
    <>
      {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
      <header className="app-header no-print">
        <div className="logo-area">
          <div className="logo-title">ğŸŒŸ Life Quest</div>
          <div className="logo-sub">survival mam Â· Premium</div>
        </div>
        <div className="header-btns">
          <button
            className={`hbtn ${lockedThisMonth ? 'hbtn-locked' : 'hbtn-consult'}`}
            onClick={openModal}
            title={lockedThisMonth ? 'ä»Šæœˆåˆ†ã¯é€ä¿¡æ¸ˆã¿' : 'ç›¸è«‡ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‹ã'}>
            ğŸ“§ ç›¸è«‡
          </button>
          <button className="hbtn hbtn-print" onClick={() => window.print()}>ğŸ–¨ï¸ å°åˆ·</button>
        </div>
      </header>

      {/* ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ãƒãƒŠãƒ¼ */}
      {(cooldownMsg || lockedThisMonth) && (
        <div className="cooldown-banner no-print">
          â³ {cooldownMsg || `ä»Šæœˆã®ç›¸è«‡ã¯é€ä¿¡æ¸ˆã¿ã§ã™ã€‚æ¬¡ã¯ ${nextMonthLabel()} ã‹ã‚‰ï¼`}
        </div>
      )}

      {/* ãƒ¬ãƒ™ãƒ«ã‚«ãƒ¼ãƒ‰ */}
      <div className="level-card no-print fade-up" style={{animationDelay:'0.05s'}}>
        <div className="level-row">
          <div>
            <div className="level-label">Current Level</div>
            <div className="level-num">LV. 1</div>
          </div>
          <div className="streak-badge">ğŸ”¥ 7 DAYS STREAK</div>
        </div>
        <div className="xp-bar-bg">
          <div className="xp-bar" style={{width:`${(xp / quests.length)*100}%`}}/>
        </div>
        <div className="xp-labels">
          <span>XP {xp * 33} / 100</span>
          <span>{xp}/{quests.length} ã‚¯ã‚¨ã‚¹ãƒˆé”æˆ</span>
        </div>
      </div>

      {/* ã‚¯ã‚¨ã‚¹ãƒˆãƒªã‚¹ãƒˆ */}
      <div className="quest-list no-print">
        {quests.map((q, i) => (
          <div key={q.id}
            className={`quest-card ${q.done ? 'done' : ''} fade-up`}
            style={{animationDelay:`${0.1 + i*0.07}s`}}
            onClick={() => toggle(q.id)}>
            <div className={`quest-icon-wrap ${questColors[i % questColors.length]}`}>
              {q.icon}
            </div>
            <div className="quest-body">
              <div className="quest-title">{q.title}</div>
              <div className="quest-reward">âœ¨ å ±é…¬ï¼š{q.reward}</div>
            </div>
            <div className={`quest-check ${q.done ? 'checked' : ''}`}>
              {q.done ? 'âœ…' : 'â­•'}
            </div>
          </div>
        ))}
      </div>

      {/* ã²ã¨ã“ã¨ */}
      <p className="bottom-msg no-print">
        ã€Œå¤§ä¸ˆå¤«ã€‚ã‚ãªãŸã¯ã€æ±ºã—ã¦ä¸€äººã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã€ ğŸŒ¸
      </p>

      {/* â”€â”€ ç›¸è«‡ãƒ¢ãƒ¼ãƒ€ãƒ« â”€â”€ */}
      {modalOpen && (
        <div className="modal-overlay no-print" onClick={e => { if(e.target===e.currentTarget) closeModal(); }}>
          <div className="modal-box">
            <button className="modal-close" onClick={closeModal}>âœ•</button>
            <div className="modal-title">ğŸ“¬ æœˆã‚¤ãƒç›¸è«‡çª“å£</div>
            <div className="modal-sub">3ã‚¹ãƒ†ãƒƒãƒ—ã§ä»Šã®çŠ¶æ³ã‚’æ•™ãˆã¦ãã ã•ã„ï¼ˆæ›¸ã‘ã‚‹ç¯„å›²ã§OKï¼‰</div>

            <Progress/>

            <form onSubmit={submit}>
              {/* å…±é€šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */}
              <div style={{marginBottom:14}}>
                <div className="field-wrap">
                  <label className="field-label">è¿”ä¿¡å…ˆãƒ¡ãƒ¼ãƒ«ï¼ˆä»»æ„ï¼‰</label>
                  <input type="email" className="form-input" placeholder="example@gmail.com"
                    value={form.reply_to} onChange={e => setField('reply_to', e.target.value)}/>
                </div>
                <div className="field-wrap" style={{marginBottom:0}}>
                  <label className="field-label">ãŠå­ã•ã‚“ã®ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ï¼ˆå¿…é ˆï¼‰â˜…</label>
                  <input type="text" className="form-input" placeholder="ä¾‹ï¼šãŸã‚ã†"
                    value={form.child_name} onChange={e => setField('child_name', e.target.value)}/>
                </div>
              </div>

              {/* ã‚¹ãƒ†ãƒƒãƒ—å†…å®¹ */}
              {WIZARD_STEPS[stepIndex].key === 'traits' && <StepTraits/>}
              {WIZARD_STEPS[stepIndex].key === 'issues' && <StepIssues/>}
              {WIZARD_STEPS[stepIndex].key === 'likes'  && <StepLikes/>}

              {/* ãƒœã‚¿ãƒ³ */}
              <div className="wizard-footer">
                <button type="button" className="wbtn wbtn-back" onClick={prevStep} disabled={stepIndex===0}>
                  â† ã‚‚ã©ã‚‹
                </button>
                {stepIndex < WIZARD_STEPS.length-1 ? (
                  <button type="button" className="wbtn wbtn-next" onClick={nextStep}>
                    ã¤ãã¸ â†’
                  </button>
                ) : (
                  <button type="submit" className="wbtn wbtn-send">
                    é€ä¿¡ã™ã‚‹ ğŸ’Œ
                  </button>
                )}
              </div>

              <p className="status-msg">{status}</p>
              <p className="form-note">â€» æ›¸ã‘ã‚‹ã¨ã“ã‚ã ã‘ã§å¤§ä¸ˆå¤«ã§ã™ã€‚ã¾ã¨ã¾ã£ã¦ã„ãªãã¦ã‚‚OKï¼</p>
            </form>
          </div>
        </div>
      )}

      {/* â”€â”€ å°åˆ·ç”¨ â”€â”€ */}
      <div className="print-only" style={{padding:40, color:'black', background:'white', minHeight:'100vh'}}>
        <div style={{borderBottom:'4px solid black', paddingBottom:24, marginBottom:32, display:'flex', justifyContent:'space-between', alignItems:'flex-start'}}>
          <div>
            <h2 style={{fontSize:'2rem', fontWeight:900, marginBottom:8}}>1ãƒ¶æœˆä¼´èµ°ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ¼ãƒˆ</h2>
            <span style={{background:'black', color:'white', fontSize:'0.75rem', fontWeight:700, padding:'4px 10px'}}>survival mam Premium</span>
          </div>
        </div>
        <div style={{display:'grid', gridTemplateColumns:'1fr 1fr', gap:32}}>
          <div style={{border:'3px solid black', padding:20}}>
            <h3 style={{fontWeight:900, fontSize:'1.1rem', marginBottom:16, borderBottom:'2px solid black', paddingBottom:8}}>ğŸ“„ ä»Šé€±ã®ç”Ÿå­˜æˆ¦ç•¥</h3>
            <ul style={{fontSize:'0.9rem', fontWeight:600, lineHeight:2}}>
              <li>ãƒ»ä»Šæ—¥ã‚‚ç”Ÿãã¦ã‚‹ã€‚ãã‚Œã ã‘ã§100ç‚¹ã§ã™ã€‚</li>
              <li>ãƒ»ãƒ‘ãƒ‹ãƒƒã‚¯ã«ã¯ã€ã¾ãšæ·±å‘¼å¸ã§å¿œã˜ã¾ã—ã‚‡ã†ã€‚</li>
              <li>ãƒ»è¦ªã®ä¼‘ã¿æ™‚é–“ã‚’ã€æœ€å„ªå…ˆã®èª²é¡Œã«ã™ã‚‹ã€‚</li>
            </ul>
          </div>
          <div style={{border:'3px solid black', padding:20}}>
            <h3 style={{fontWeight:900, fontSize:'1.1rem', marginBottom:16, borderBottom:'2px solid black', paddingBottom:8}}>â­ å¤‰åŒ–ã®è¨˜éŒ²ï¼ˆæ‰‹æ›¸ãç”¨ï¼‰</h3>
            {[1,2,3,4].map(n=>(
              <div key={n} style={{borderBottom:'1.5px solid black', height:40, marginBottom:8, fontSize:'0.65rem', color:'#999', display:'flex', alignItems:'flex-end', paddingBottom:4}}>
                DATE: ___/___
              </div>
            ))}
          </div>
        </div>
        <div style={{marginTop:80, textAlign:'center'}}>
          <p style={{fontSize:'1.1rem', fontWeight:900, fontStyle:'italic'}}>ã€Œå¤§ä¸ˆå¤«ã€‚ã‚ãªãŸã¯ã€æ±ºã—ã¦ä¸€äººã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã€</p>
          <p style={{fontSize:'0.7rem', color:'#999', marginTop:12, letterSpacing:'0.1em'}}>Â© 2026 survival mam | All Rights Reserved.</p>
        </div>
      </div>
    </>
  );
}

function renderApp() {
  const root = ReactDOM.createRoot(document.getElementById('app'));
  root.render(<App/>);
}
</script>
</body>
</html>
