<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ã‚¹ãƒ¢ãƒ¼ãƒ«ã‚¹ãƒ†ãƒƒãƒ—ã‚«ãƒ¼ãƒ‰ã€ä½“é¨“ç‰ˆã€‘</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;800;900&family=Zen+Kaku+Gothic+New:wght@400;700;900&display=swap" rel="stylesheet" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Zen Kaku Gothic New','Nunito', sans-serif; min-height: 100vh; background: #f0fdf4; }

    /* â”€â”€ ä½“é¨“ç‰ˆãƒãƒŠãƒ¼ â”€â”€ */
    .taiken-banner {
      background: linear-gradient(90deg,#fef3c7,#fde68a);
      border-bottom: 2px solid #f59e0b;
      padding: 9px 16px; text-align: center;
      font-size: 12px; font-weight: 800; color: #78350f; letter-spacing: 0.04em;
    }
    .taiken-banner strong { color: #b45309; }

    /* â”€â”€ ãƒ˜ãƒƒãƒ€ãƒ¼ â”€â”€ */
    .hd { padding: 22px 16px 28px; color: #fff; }
    .hd-inner { max-width: 600px; margin: 0 auto; }
    .hd-sub   { font-size: 12px; font-weight: 700; letter-spacing: 1px; opacity: 0.8; margin-bottom: 4px; }
    .hd-title { font-size: 22px; font-weight: 900; }
    .hd-desc  { font-size: 13px; opacity: 0.8; margin-top: 5px; }
    .back-btn {
      display: inline-flex; align-items: center; gap: 6px;
      background: rgba(255,255,255,0.18); color: #fff;
      border: none; border-radius: 10px; padding: 6px 14px;
      font-size: 13px; font-weight: 800; cursor: pointer;
      font-family: inherit; margin-bottom: 10px; transition: background 0.15s;
    }
    .back-btn:hover { background: rgba(255,255,255,0.28); }

    /* â”€â”€ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ â”€â”€ */
    .content { max-width: 600px; margin: 0 auto; padding: 18px 14px 120px; }

    /* â”€â”€ ã‚¿ã‚¹ã‚¯ã‚°ãƒªãƒƒãƒ‰ â”€â”€ */
    .task-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }

    .task-card {
      background: #fff; border-radius: 20px; padding: 18px 12px; text-align: center;
      cursor: pointer; transition: all 0.18s cubic-bezier(.4,2,.6,1);
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    .task-card:hover { transform: translateY(-4px) scale(1.02); box-shadow: 0 12px 28px rgba(0,0,0,0.1); }
    .task-card:active { transform: scale(0.97); }

    /* ã‚ªãƒªã‚¸ãƒŠãƒ«ä½œæˆã‚«ãƒ¼ãƒ‰ï¼ˆãƒ­ãƒƒã‚¯ï¼‰ */
    .task-card.locked-create {
      background: #f8fafc; border: 2px dashed #cbd5e1; cursor: default;
    }
    .task-card.locked-create:hover { transform: none; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }

    .task-icon  { font-size: 40px; margin-bottom: 8px; }
    .task-title { font-weight: 900; font-size: 14px; color: #1e293b; margin-bottom: 5px; }
    .task-steps-badge {
      font-size: 11px; font-weight: 700; padding: 3px 10px; border-radius: 99px;
      display: inline-block;
    }
    .task-count { font-size: 11px; color: #64748b; margin-top: 5px; }
    .lock-badge {
      display: inline-flex; align-items: center; gap: 4px;
      font-size: 11px; font-weight: 800; color: #94a3b8;
      background: #f1f5f9; border: 1px solid #e2e8f0;
      padding: 3px 10px; border-radius: 99px; margin-top: 6px;
    }

    /* â”€â”€ ä½¿ã„æ–¹ â”€â”€ */
    .howto {
      background: #fff; border-radius: 16px; padding: 16px 18px;
      border: 1px solid #d1fae5; margin-bottom: 20px;
    }
    .howto-ttl { font-weight: 900; font-size: 14px; color: #065f46; margin-bottom: 7px; }
    .howto-txt { font-size: 13px; color: #374151; line-height: 1.75; }

    /* â”€â”€ è£½å“ç‰ˆå‘ŠçŸ¥ â”€â”€ */
    .pro-notice {
      background: linear-gradient(135deg,#f0fdf4,#dcfce7);
      border: 1.5px solid #86efac; border-radius: 16px;
      padding: 18px 18px; margin-bottom: 20px;
    }
    .pro-notice-ttl { font-weight: 900; font-size: 13px; color: #065f46; margin-bottom: 10px; }
    .pro-notice-item { display: flex; align-items: flex-start; gap: 8px; font-size: 13px; color: #374151; font-weight: 700; margin-bottom: 7px; line-height: 1.5; }
    .pro-notice-item:last-child { margin-bottom: 0; }

    /* â”€â”€ ã‚¿ã‚¹ã‚¯å®Ÿè¡Œç”»é¢ â”€â”€ */
    .task-run-hd { padding: 18px 16px 24px; color: #fff; }
    .task-run-hd-inner { max-width: 600px; margin: 0 auto; }
    .task-run-info { display: flex; align-items: center; gap: 14px; }
    .task-run-icon { font-size: 46px; }
    .task-run-name { font-size: 20px; font-weight: 900; }
    .task-run-prog-txt { font-size: 13px; opacity: 0.8; margin-top: 2px; }

    /* å††ã‚°ãƒ©ãƒ• */
    .ring-wrap { position: relative; width: 72px; height: 72px; flex-shrink: 0; }
    .ring-pct  { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 16px; font-weight: 900; color: #fff; }

    /* è‡ªå·±é¸æŠãƒˆã‚°ãƒ« */
    .toggle-row {
      background: #fff; border-radius: 14px; padding: 12px 16px; margin-bottom: 16px;
      display: flex; align-items: center; gap: 12;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .toggle-label { flex: 1; }
    .toggle-label-main { font-size: 14px; font-weight: 900; color: #374151; }
    .toggle-label-sub  { font-size: 12px; color: #64748b; margin-top: 2px; }
    .toggle-switch {
      width: 48px; height: 28px; border-radius: 99px; background: #e5e7eb;
      cursor: pointer; position: relative; transition: background 0.2s; flex-shrink: 0;
    }
    .toggle-knob {
      position: absolute; top: 4px; left: 4px;
      width: 20px; height: 20px; border-radius: 99px; background: #fff;
      box-shadow: 0 1px 4px rgba(0,0,0,0.2); transition: left 0.2s;
    }

    /* ã‚¹ãƒ†ãƒƒãƒ—ã‚«ãƒ¼ãƒ‰ */
    .steps-list { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
    .step-item {
      background: #fff; border: 2px solid #e5e7eb; border-radius: 18px;
      padding: 15px 16px; display: flex; align-items: center; gap: 14px;
      cursor: pointer; transition: all 0.2s cubic-bezier(.4,2,.6,1);
    }
    .step-item:hover { transform: scale(1.02); }
    .step-item:active { transform: scale(0.98); }
    .step-item.done { opacity: 0.65; }
    .step-item.locked-step { opacity: 0.45; cursor: not-allowed; background: #f8fafc; }
    .step-item.locked-step:hover { transform: none; }
    .step-avatar {
      width: 44px; height: 44px; border-radius: 99px; flex-shrink: 0;
      display: flex; align-items: center; justify-content: center;
      font-size: 22px; background: #f1f5f9; transition: all 0.25s;
    }
    .step-meta { flex: 1; }
    .step-num-row { display: flex; align-items: center; gap: 8px; margin-bottom: 3px; }
    .step-num { font-size: 11px; font-weight: 900; padding: 2px 8px; border-radius: 99px; background: #f1f5f9; color: #94a3b8; }
    .step-current-lbl { font-size: 11px; font-weight: 900; }
    .step-label { font-size: 16px; font-weight: 900; color: #1e293b; }
    .step-label.done-txt { text-decoration: line-through; color: #94a3b8; font-weight: 700; }

    /* å®Œäº†ãƒ‘ãƒãƒ« */
    .done-panel {
      background: #fff; border-radius: 20px; padding: 24px;
      text-align: center; box-shadow: 0 4px 16px rgba(0,0,0,0.08);
    }
    .done-emoji { font-size: 52px; margin-bottom: 10px; }
    .done-title { font-size: 22px; font-weight: 900; color: #065f46; margin-bottom: 4px; }
    .done-sub   { font-size: 14px; color: #64748b; margin-bottom: 20px; }
    .done-btn {
      width: 100%; padding: 16px 36px; border-radius: 16px; border: none;
      font-size: 15px; font-weight: 900; cursor: pointer; font-family: inherit; color: #fff;
      box-shadow: 0 6px 20px rgba(0,0,0,0.15); display: block;
      transition: all 0.15s; margin-bottom: 16px;
    }
    .done-btn:hover { filter: brightness(1.08); transform: scale(1.02); }

    /* ãŠç¥ã„ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
    .celeb-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 9999;
      display: flex; align-items: center; justify-content: center;
    }
    .celeb-box {
      background: #fff; border-radius: 32px; padding: 40px;
      text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      animation: celebIn 0.4s cubic-bezier(.4,2,.6,1);
    }
    @keyframes celebIn { from{transform:scale(0.5);opacity:0} to{transform:scale(1);opacity:1} }
    .celeb-ico { font-size: 72px; margin-bottom: 12px; }
    .celeb-ttl { font-size: 24px; font-weight: 900; color: #1e293b; }
    .celeb-sub { font-size: 15px; color: #64748b; margin-top: 8px; }

    /* â”€â”€ CTA â”€â”€ */
    .cta-block {
      background: linear-gradient(135deg,#f0fdf4,#dcfce7);
      border: 1.5px solid #86efac; border-radius: 20px;
      padding: 22px 18px; text-align: center; margin-top: 8px;
    }
    .cta-eyebrow { font-size: 11px; font-weight: 900; letter-spacing: 0.15em; color: #059669; text-transform: uppercase; margin-bottom: 8px; }
    .cta-text { font-size: 14px; font-weight: 800; color: #1e293b; line-height: 1.75; margin-bottom: 16px; }
    .cta-btn {
      display: inline-block; background: linear-gradient(135deg,#c8a97e,#d4b896);
      color: #fff; font-size: 14px; font-weight: 900; padding: 13px 26px;
      border-radius: 99px; text-decoration: none;
      box-shadow: 0 6px 20px rgba(200,169,126,0.4); font-family: inherit;
      transition: all 0.18s cubic-bezier(.34,1.4,.64,1);
    }
    .cta-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 28px rgba(200,169,126,0.5); }

    .hidden { display: none !important; }
    @keyframes pop { 0%{transform:scale(0.82)} 60%{transform:scale(1.12)} 100%{transform:scale(1)} }
    .pop { animation: pop 0.32s cubic-bezier(.4,2,.6,1); }
  </style>
</head>
<body>

<div class="taiken-banner">
  âš ï¸ ã“ã‚Œã¯<strong>ä½“é¨“ç‰ˆ</strong>ã§ã™ã€€ï¼ã€€5ã¤ã®ãƒ—ãƒªã‚»ãƒƒãƒˆã‚¿ã‚¹ã‚¯ã‚’ç„¡æ–™ä½“é¨“ã§ãã¾ã™
</div>

<!-- ãƒ›ãƒ¼ãƒ ç”»é¢ -->
<div id="screen-home">
  <div class="hd" style="background:linear-gradient(135deg,#059669,#10b981)">
    <div class="hd-inner">
      <div class="hd-sub">ã€ä½“é¨“ç‰ˆã€‘ã‚¹ãƒ¢ãƒ¼ãƒ«ã‚¹ãƒ†ãƒƒãƒ—ã‚«ãƒ¼ãƒ‰</div>
      <div class="hd-title">âœ… ã‚„ã‚‹ã“ã¨ã‚’ã‚ã‘ã‚ˆã†ï¼</div>
      <div class="hd-desc">ã€Œã§ããªã„ã€ã‚’ã€Œã§ããŸã€ã«ã‹ãˆã‚‹åˆ†è§£è¡“</div>
    </div>
  </div>
  <div class="content">

    <div style="font-weight:900;font-size:15px;color:#065f46;margin-bottom:12px">ğŸ“‹ ã‚¿ã‚¹ã‚¯ã‚’ãˆã‚‰ã¼ã†</div>

    <div class="task-grid" id="task-grid">
      <!-- JSã§æç”» -->
    </div>

    <!-- ä½¿ã„æ–¹ -->
    <div class="howto">
      <div class="howto-ttl">ğŸ’¡ ã¤ã‹ã„ã‹ãŸ</div>
      <div class="howto-txt">
        ã‚¿ã‚¹ã‚¯ã‚’ãˆã‚‰ã‚“ã§ã€ã²ã¨ã¤ãšã¤ã‚¿ãƒƒãƒ—ã—ãªãŒã‚‰ã™ã™ã‚‚ã†ã€‚<br>
        ã€Œã§ããŸï¼ã€ã‚’ã‚ã¤ã‚ã¦ã€ã˜ã—ã‚“ã‚’ã¤ã‘ã‚ˆã†âœ¨
      </div>
    </div>

    <!-- è£½å“ç‰ˆå‘ŠçŸ¥ -->
    <div class="pro-notice">
      <div class="pro-notice-ttl">ğŸ“¦ è£½å“ç‰ˆã§ã¯ã•ã‚‰ã«ã§ãã‚‹ã“ã¨</div>
      <div class="pro-notice-item">âœ” ãŠå­ã•ã¾ã«åˆã‚ã›ãŸã‚ªãƒªã‚¸ãƒŠãƒ«ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆ</div>
      <div class="pro-notice-item">âœ” ã‚¹ãƒ†ãƒƒãƒ—ã‚’ã˜ã¶ã‚“ã§è¿½åŠ ãƒ»ç·¨é›†ãƒ»ä¿å­˜</div>
      <div class="pro-notice-item">âœ” ã‚¯ãƒªã‚¢å›æ•°ã®è¨˜éŒ²ã¨å±¥æ­´ç®¡ç†</div>
    </div>

    <!-- CTA -->
    <div class="cta-block">
      <div class="cta-eyebrow">ï¼¼ ãƒ•ãƒ«æ©Ÿèƒ½ã¯ã“ã¡ã‚‰ ï¼</div>
      <div class="cta-text">
        ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚¿ã‚¹ã‚¯ä½œæˆãƒ»ä¿å­˜æ©Ÿèƒ½<br>
        ã‚¯ãƒªã‚¢è¨˜éŒ²ãƒ»ç·¨é›†æ©Ÿèƒ½<br>
        ã™ã¹ã¦ä½¿ã„æ”¾é¡Œ
      </div>
      <a class="cta-btn" href="https://buy.stripe.com/4gMcN7aZgdWldmW3tR73G06" target="_blank">ã‚¹ãƒ¢ãƒ¼ãƒ«ã‚¹ãƒ†ãƒƒãƒ—ã‚«ãƒ¼ãƒ‰ã‚’è³¼å…¥ã™ã‚‹ â†’</a>
    </div>
  </div>
</div>

<!-- ã‚¿ã‚¹ã‚¯å®Ÿè¡Œç”»é¢ -->
<div id="screen-task" class="hidden">
  <div class="task-run-hd" id="task-hd-wrap">
    <div class="task-run-hd-inner">
      <button class="back-btn" onclick="backHome()">â† ã‚‚ã©ã‚‹</button>
      <div class="task-run-info">
        <div class="task-run-icon" id="task-icon">ğŸ“</div>
        <div style="flex:1">
          <div class="task-run-name" id="task-name">ã‚¿ã‚¹ã‚¯</div>
          <div class="task-run-prog-txt" id="task-prog-txt">0/6 ã‚¹ãƒ†ãƒƒãƒ—</div>
        </div>
        <div class="ring-wrap">
          <svg id="ring-svg" width="72" height="72" style="transform:rotate(-90deg)">
            <circle cx="36" cy="36" r="31" fill="none" stroke="rgba(255,255,255,0.25)" stroke-width="7"/>
            <circle id="ring-fill" cx="36" cy="36" r="31" fill="none" stroke="#fff" stroke-width="7"
              stroke-dasharray="194.8" stroke-dashoffset="194.8" stroke-linecap="round"
              style="transition:stroke-dashoffset 0.5s cubic-bezier(.4,0,.2,1)"/>
          </svg>
          <div class="ring-pct" id="ring-pct">0%</div>
        </div>
      </div>
    </div>
  </div>

  <div class="content">
    <!-- è‡ªå·±é¸æŠãƒˆã‚°ãƒ« -->
    <div class="toggle-row" style="display:flex;align-items:center;gap:12px;background:#fff;border-radius:14px;padding:12px 16px;margin-bottom:16px;box-shadow:0 2px 8px rgba(0,0,0,0.05)">
      <div class="toggle-label" style="flex:1">
        <div class="toggle-label-main">ğŸ”€ ã˜ã¶ã‚“ã§ãˆã‚‰ã¶ãƒ¢ãƒ¼ãƒ‰</div>
        <div class="toggle-label-sub">ã™ããªã˜ã‚…ã‚“ã°ã‚“ã§ã‚„ã£ã¦ã¿ã‚ˆã†</div>
      </div>
      <div class="toggle-switch" id="toggle-sw" onclick="toggleSelfChoice()">
        <div class="toggle-knob" id="toggle-knob"></div>
      </div>
    </div>

    <!-- ã‚¹ãƒ†ãƒƒãƒ—ãƒªã‚¹ãƒˆ -->
    <div class="steps-list" id="steps-list"></div>

    <!-- å®Œäº†ãƒ‘ãƒãƒ« -->
    <div class="done-panel hidden" id="done-panel">
      <div class="done-emoji">ğŸ‰</div>
      <div class="done-title">ãœã‚“ã¶ã‚¯ãƒªã‚¢ï¼ï¼</div>
      <div class="done-sub">ã‚ˆãã§ãã¾ã—ãŸï¼ã™ã”ã„ï¼</div>
      <button class="done-btn" id="done-retry-btn" onclick="retryTask()">ã‚‚ã†ã„ã¡ã© â†©</button>
      <div class="cta-block">
        <div class="cta-eyebrow">ï¼¼ ãƒ•ãƒ«æ©Ÿèƒ½ã¯ã“ã¡ã‚‰ ï¼</div>
        <div class="cta-text">ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚¿ã‚¹ã‚¯ä½œæˆãƒ»ä¿å­˜ãƒ»ç·¨é›†<br>ã™ã¹ã¦ä½¿ã„æ”¾é¡Œ</div>
        <a class="cta-btn" href="https://buy.stripe.com/4gMcN7aZgdWldmW3tR73G06" target="_blank">ã‚¹ãƒ¢ãƒ¼ãƒ«ã‚¹ãƒ†ãƒƒãƒ—ã‚«ãƒ¼ãƒ‰ã‚’è³¼å…¥ã™ã‚‹ â†’</a>
      </div>
    </div>
  </div>
</div>

<!-- ãŠç¥ã„ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
<div class="celeb-overlay hidden" id="celeb">
  <div class="celeb-box">
    <div class="celeb-ico">ğŸŠ</div>
    <div class="celeb-ttl">ãœã‚“ã¶ã§ããŸï¼ï¼</div>
    <div class="celeb-sub">ã™ã”ã„ï¼ã•ã„ã“ã†ã ã‚ˆï¼</div>
  </div>
</div>

<script>
var TASKS = [
  { id:"homework", icon:"ğŸ“", title:"ã—ã‚…ãã ã„", color:"#3b82f6", light:"#eff6ff",
    steps:[
      {id:"s1",label:"ãµã§ã°ã“ã‚’ã ã™",    icon:"âœï¸"},
      {id:"s2",label:"ãƒãƒ¼ãƒˆã‚’ã²ã‚‰ã",    icon:"ğŸ“–"},
      {id:"s3",label:"ãã‚‡ã†ã‹ã—ã‚‡ã‚’ã‚ˆã‚€",icon:"ğŸ“š"},
      {id:"s4",label:"ã‚‚ã‚“ã ã„ã‚’ã¨ã",    icon:"ğŸ¤”"},
      {id:"s5",label:"ã“ãŸãˆã‚’ã‹ã",      icon:"âœï¸"},
      {id:"s6",label:"ã¾ã‚‹ã¤ã‘ã‚’ã™ã‚‹",    icon:"â­•"},
    ]},
  { id:"morning", icon:"ğŸŒ…", title:"ã‚ã•ã®ã—ãŸã", color:"#f59e0b", light:"#fffbeb",
    steps:[
      {id:"s1",label:"ã‚ã‚’ã•ã¾ã™",    icon:"ğŸ‘€"},
      {id:"s2",label:"ãƒ‘ã‚¸ãƒ£ãƒã‚’ã¬ã",icon:"ğŸ‘•"},
      {id:"s3",label:"ããŒãˆã‚‹",      icon:"ğŸ§¥"},
      {id:"s4",label:"ã‹ãŠã‚’ã‚ã‚‰ã†",  icon:"ğŸ’§"},
      {id:"s5",label:"ã”ã¯ã‚“ã‚’ãŸã¹ã‚‹",icon:"ğŸš"},
      {id:"s6",label:"ã¯ã‚’ã¿ãŒã",    icon:"ğŸ¦·"},
    ]},
  { id:"bath", icon:"ğŸ›", title:"ãŠãµã‚", color:"#06b6d4", light:"#ecfeff",
    steps:[
      {id:"s1",label:"ãŠãµã‚ã«ã¯ã„ã‚‹",icon:"ğŸš¿"},
      {id:"s2",label:"ã‚ãŸã¾ã‚’ã‚ã‚‰ã†",icon:"ğŸ§´"},
      {id:"s3",label:"ã‹ã‚‰ã ã‚’ã‚ã‚‰ã†",icon:"ğŸ§¼"},
      {id:"s4",label:"ã‚ã‚ã‚’ãªãŒã™",  icon:"ğŸ’¦"},
      {id:"s5",label:"ã‚¿ã‚ªãƒ«ã§ãµã",  icon:"ğŸŠ"},
      {id:"s6",label:"ãƒ‘ã‚¸ãƒ£ãƒã‚’ãã‚‹",icon:"ğŸŒ™"},
    ]},
  { id:"tidy", icon:"ğŸ§¹", title:"ãŠã‹ãŸã¥ã‘", color:"#10b981", light:"#ecfdf5",
    steps:[
      {id:"s1",label:"ã¡ã‚‰ã‹ã£ã¦ã„ã‚‹ã‚‚ã®ã‚’ã•ãŒã™",icon:"ğŸ”"},
      {id:"s2",label:"ãŠã‚‚ã¡ã‚ƒã‚’ã‚ã¤ã‚ã‚‹",        icon:"ğŸª€"},
      {id:"s3",label:"ã»ã‚“ã‚’ãªã‚‰ã¹ã‚‹",            icon:"ğŸ“š"},
      {id:"s4",label:"ã”ã¿ã‚’ã²ã‚ã†",              icon:"ğŸ—‘ï¸"},
      {id:"s5",label:"ã‚‚ã¨ã®ã°ã—ã‚‡ã«ã‚‚ã©ã™",      icon:"ğŸ“¦"},
      {id:"s6",label:"ã•ã„ã”ã«ã‹ãã«ã‚“ã™ã‚‹",      icon:"âœ…"},
    ]},
  { id:"sleep", icon:"ğŸ˜´", title:"ã­ã‚‹ã˜ã‚…ã‚“ã³", color:"#8b5cf6", light:"#f5f3ff",
    steps:[
      {id:"s1",label:"ã¯ã‚’ã¿ãŒã",          icon:"ğŸ¦·"},
      {id:"s2",label:"ãƒˆã‚¤ãƒ¬ã«ã„ã",        icon:"ğŸš½"},
      {id:"s3",label:"ãƒ‘ã‚¸ãƒ£ãƒã«ããŒãˆã‚‹",  icon:"ğŸŒ™"},
      {id:"s4",label:"ã‚ã—ãŸã®ã˜ã‚…ã‚“ã³ã‚’ã™ã‚‹",icon:"ğŸ’"},
      {id:"s5",label:"ã§ã‚“ãã‚’ã‘ã™",        icon:"ğŸ’¡"},
      {id:"s6",label:"ãµã¨ã‚“ã«ã¯ã„ã‚‹",      icon:"ğŸ›ï¸"},
    ]},
];

var curTask = null;
var completed = [];
var selfChoice = false;
var history = {};

renderHome();

function renderHome(){
  var grid = document.getElementById("task-grid");
  grid.innerHTML = "";

  TASKS.forEach(function(task){
    var count = history[task.id] || 0;
    var div = document.createElement("div");
    div.className = "task-card";
    div.style.border = "2px solid " + task.color + "33";
    div.innerHTML =
      '<div class="task-icon">'+task.icon+'</div>'+
      '<div class="task-title">'+task.title+'</div>'+
      '<div class="task-steps-badge" style="background:'+task.color+'15;color:'+task.color+'">'+task.steps.length+'ã‚¹ãƒ†ãƒƒãƒ—</div>'+
      (count > 0 ? '<div class="task-count">'+count+'ã‹ã„ã‚¯ãƒªã‚¢ğŸ‰</div>' : '');
    div.addEventListener("click", function(){ startTask(task); });
    grid.appendChild(div);
  });

  // ã‚ªãƒªã‚¸ãƒŠãƒ«ä½œæˆ ãƒ­ãƒƒã‚¯
  var lockDiv = document.createElement("div");
  lockDiv.className = "task-card locked-create";
  lockDiv.innerHTML =
    '<div class="task-icon">â•</div>'+
    '<div class="task-title" style="color:#94a3b8">ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚’ä½œã‚‹</div>'+
    '<div class="task-steps-badge" style="background:#f1f5f9;color:#94a3b8">ã˜ã¶ã‚“ã§ã¤ãã‚ã†</div>'+
    '<div class="lock-badge">ğŸ”’ è£½å“ç‰ˆ</div>';
  grid.appendChild(lockDiv);
}

function startTask(task){
  curTask = task;
  completed = [];
  selfChoice = false;

  // ãƒ˜ãƒƒãƒ€ãƒ¼è‰²
  document.getElementById("task-hd-wrap").style.background =
    "linear-gradient(135deg," + task.color + "," + task.color + "cc)";
  document.getElementById("task-icon").textContent = task.icon;
  document.getElementById("task-name").textContent = task.title;

  // ãƒˆã‚°ãƒ«ãƒªã‚»ãƒƒãƒˆ
  updateToggleUI();

  // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
  document.getElementById("screen-home").classList.add("hidden");
  document.getElementById("screen-task").classList.remove("hidden");
  document.getElementById("done-panel").classList.add("hidden");

  renderSteps();
  updateRing();
}

function backHome(){
  document.getElementById("screen-task").classList.add("hidden");
  document.getElementById("screen-home").classList.remove("hidden");
  renderHome();
}

function renderSteps(){
  var list = document.getElementById("steps-list");
  list.innerHTML = "";
  var task = curTask;
  var currentIdx = selfChoice ? -1 : task.steps.findIndex(function(s){ return completed.indexOf(s.id) === -1; });

  task.steps.forEach(function(step, i){
    var done   = completed.indexOf(step.id) !== -1;
    var isCur  = !selfChoice && i === currentIdx;
    var isLock = !selfChoice && i > currentIdx;

    var div = document.createElement("div");
    div.className = "step-item" + (done ? " done" : "") + (isLock ? " locked-step" : "");
    if(done){
      div.style.background = task.color + "18";
      div.style.borderColor = task.color;
    } else if(isCur){
      div.style.borderColor = task.color + "88";
      div.style.boxShadow = "0 4px 16px " + task.color + "30";
      div.style.transform = "scale(1.01)";
    }

    var avatarBg = done ? task.color : (isCur ? task.color + "20" : "#f1f5f9");
    var avatarContent = done ? "âœ…" : step.icon;

    div.innerHTML =
      '<div class="step-avatar" style="background:' + avatarBg + '">' + avatarContent + '</div>'+
      '<div class="step-meta">'+
        '<div class="step-num-row">'+
          '<span class="step-num" style="' + (done ? 'background:'+task.color+'15;color:'+task.color : '') + '">' + (i+1) + '</span>'+
          (isCur ? '<span class="step-current-lbl" style="color:'+task.color+'">â† ã„ã¾ã“ã“ï¼</span>' : '')+
        '</div>'+
        '<div class="step-label' + (done ? ' done-txt' : '') + '">' + step.label + '</div>'+
      '</div>';

    if(!isLock){
      div.addEventListener("click", function(){ toggleStep(step.id); });
    }
    list.appendChild(div);
  });

  // é€²è¡Œãƒ†ã‚­ã‚¹ãƒˆ
  document.getElementById("task-prog-txt").textContent =
    completed.length + "/" + task.steps.length + " ã‚¹ãƒ†ãƒƒãƒ—";
}

function toggleStep(stepId){
  var idx = completed.indexOf(stepId);
  if(idx !== -1){
    completed.splice(idx, 1);
  } else {
    completed.push(stepId);
    // ãƒãƒƒãƒ—ã‚¢ãƒ‹ãƒ¡
    renderSteps();
    updateRing();
    if(completed.length === curTask.steps.length){
      showCelebration();
    }
    return;
  }
  renderSteps();
  updateRing();
}

function showCelebration(){
  history[curTask.id] = (history[curTask.id] || 0) + 1;
  var cel = document.getElementById("celeb");
  cel.classList.remove("hidden");
  setTimeout(function(){
    cel.classList.add("hidden");
    document.getElementById("done-panel").classList.remove("hidden");
    document.getElementById("done-retry-btn").style.background =
      "linear-gradient(135deg," + curTask.color + "," + curTask.color + "cc)";
    document.getElementById("done-retry-btn").style.boxShadow =
      "0 6px 20px " + curTask.color + "55";
  }, 2600);
}

function retryTask(){
  completed = [];
  document.getElementById("done-panel").classList.add("hidden");
  renderSteps();
  updateRing();
}

function updateRing(){
  var pct = curTask ? Math.round((completed.length / curTask.steps.length) * 100) : 0;
  var circ = 2 * Math.PI * 31; // r=31
  var offset = circ * (1 - pct / 100);
  document.getElementById("ring-fill").style.strokeDashoffset = offset;
  document.getElementById("ring-pct").textContent = pct + "%";
}

function toggleSelfChoice(){
  selfChoice = !selfChoice;
  updateToggleUI();
  renderSteps();
}

function updateToggleUI(){
  var sw    = document.getElementById("toggle-sw");
  var knob  = document.getElementById("toggle-knob");
  if(selfChoice){
    sw.style.background = curTask ? curTask.color : "#10b981";
    knob.style.left = "24px";
  } else {
    sw.style.background = "#e5e7eb";
    knob.style.left = "4px";
  }
}
</script>
</body>
</html>
